<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>360 Web Tour Maker</title>
		<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
		
		<link rel="stylesheet" type="text/css" href="css/font-awesome.css">
		<link rel="stylesheet" type="text/css" href="style.css">
		
		<!-- Insert this line above script imports  -->
		<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
				
		<script src="jquery.js"></script>
		
		<!-- Insert this line after script imports -->
		<script>if (window.module) module = window.module;</script>
		
		<script>
			var projectext = ".wtm";
			const { dialog, BrowserWindow } = require('electron').remote;
			const { ipcRenderer } = require('electron');
			const fs = require('fs');
			const fse = require("fs-extra");
		</script>
		
	</head>
	
	<body style="display: none;">
		<div id="appbar">
			<a href="https://3sixty.webappdev.my.id"><div style="-webkit-app-region: no-drag; cursor: pointer; background-color: #0d9e59; color: white; padding: 10px; display: inline-block; font-weight: bold;">3Sixty</div></a>
			<div class="abitem">
				File
				<div class="dropdown-content">
					<div class="subabitem" onclick="showpage('projects')"><div style="display: inline-block; width: 190px;"><i class="fa fa-briefcase" style="width: 30px;"></i> Projects</div><div style="display: inline-block; color: gray;">Ctrl+P</div></div>
					<div class="subabitem" onclick="openproject()"><div style="display: inline-block; width: 190px;"><i class="fa fa-folder" style="width: 30px;"></i> Open Existing Project</div><div style="display: inline-block; color: gray;">Ctrl+O</div></div>
					<div class="subabitem" onclick="quitprogram()"><div style="display: inline-block; width: 190px;"><i class="fa fa-times" style="width: 30px;"></i> Exit</div><div style="display: inline-block; color: gray;">Ctrl+Q</div></div>
				</div>
			</div>
			<div class="abitem">
				Help
				<div class="dropdown-content">
					<div class="subabitem" onclick="showpage('tutorials')"><div style="display: inline-block; width: 190px;"><i class="fa fa-film" style="width: 30px;"></i> Tutorials</div><div style="display: inline-block; color: gray;">Ctrl+T</div></div>
					<div class="subabitem" onclick="showMiniPage('donate')"><div style="display: inline-block; width: 190px;"><i class="fa fa-paypal" style="width: 30px;"></i> Support The Dev.</div><div style="display: inline-block; color: gray;">Ctrl+S</div></div>
					<div class="subabitem" onclick="showMiniPage('about')"><div style="display: inline-block; width: 190px;"><i class="fa fa-question" style="width: 30px;"></i> About</div><div style="display: inline-block; color: gray;">Ctrl+B</div></div>					
				</div>
			</div>
			<div style="float: right;">
				<div class="abitem rightbtn minimizebutton" onclick="minimize()" style="width: 30px; text-align: center;"><i class="fa fa-window-minimize"></i></div>
				<div class="abitem rightbtn minmaxbutton" onclick="maximize()" style="width: 30px; text-align: center;"><i class="fa fa-window-restore"></i></div>
				<div class="abitem rightbtn closebutton" onclick="quitprogram()" style="width: 30px; text-align: center;"><i class="fa fa-times"></i></div>
			</div>
		</div>
		
		<!-- Tutorials -->
		<div class="page" id="tutorials">
			<h1>Video Tutorials</h1>
			<p>Visit my channel yaaaa...</p>
		</div>
		
		<!-- What is -->
		<div class="page" id="whatis">
			<h1>What is 360 Web Tour Maker</h1>
			<p>360 Web Tour Maker is a 100% free desktop software built for you to make a 360 panorama virtual tour for web.</p>
			<p>This software is made with so many wonderful open source technologies such as HTML5, JavaScript, jQuery, three.js, panolens and so on.</p>
		</div>
		
		<!-- Projects -->
		<div class="page" id="projects">
			<h1>Projects</h1>
			<div style="display: table; width: 100%; table-layout: fixed;">
				<div style="display: table-cell; vertical-align: top; width: 30%; overflow-x: hidden;">
					<h2><i class="fa fa-pencil"></i> Create New Project</h2>
					<div>
						<p style="font-size: 12px; font-style: italic;">1. Project Name</p>
						<input id="newprojectname" placeholder="Give it a name">
					</div>
					<div>
						<p style="font-size: 12px; font-style: italic;">2. Project Directory</p>
						<p id="newprojectdir"></p>
						<button onclick="chooseprojectdir()"><i class="fa fa-folder"></i> Browse</button>
					</div>
					<div>
						<p style="font-size: 12px; font-style: italic;">3. Hit Create Button!</p>
						<button onclick="createproject()"><i class="fa fa-chevron-right"></i> Create</button>
					</div>
					
					<!--
					<h2><i class="fa fa-folder"></i> Or Open Existing Project</h2>
					<div>
						<p style="font-size: 12px; font-style: italic;">Click to browse</p>
						<button onclick="openproject()"><i class="fa fa-folder"></i> Browse</button>
					</div>
					-->
					<script>
						var newprojectname = "";
						var newprojectdir = "";
						function chooseprojectdir(){
							newprojectname = $("#newprojectname").val();
							if(newprojectname != ""){
								dialog.showOpenDialog({
									properties: ['openDirectory']
								}).then(result => {
									newprojectdir = result.filePaths[0];
									if(newprojectdir != undefined){
										$("#newprojectdir").html(newprojectdir);
									}else{
										$("#newprojectdir").html("");
										newprojectdir = "";
									}
								});
							}else{
								showAlert("Incomplete Information", "Enter your Project Name first, then specify the directory.");
								$("#newprojectname").focus();
								
							}
							
						}
						
						function openproject(){
							var openedprojectdir = "";
							dialog.showOpenDialog({
								properties: ['openDirectory']
							}).then(result => {
								openedprojectdir = result.filePaths[0];
								if(openedprojectdir != undefined){
									//showAlert("Open Project", "Is this correct: " + openedprojectdir + " ?");
									//Try to get the WTMProject.wtm file
									if(fs.existsSync(openedprojectdir + "\\WTMProject.wtm")){
										fs.readFile(openedprojectdir + "\\WTMProject.wtm", 'utf8', function (err,data) {
											if (err) {
												showAlert("Open Project", "This is NOT a valid project.");
												return console.log(err);
											}
											var openedprojecttitle = JSON.parse(data).title;
											openedprojectdir = openedprojectdir.replace(/\\/g, "/");
											
											if(isProjectExist(openedprojecttitle, openedprojectdir)){
												showAlert("Open Project", "This project already exists in Recent Projects list.");
											}else{
												//showAlert("Open Project", "Project has been successfully added to Recent Projects list.");
												wtmdata.projects.push({
													projectdir : openedprojectdir,
													projectname : openedprojecttitle,
												});
												saveWtmdata();
												loadRecentProjects();
											}
										});
									}else{
										showAlert("Open Project", "This is NOT a valid project.");
									}
								}
							});
						}
						
						function createproject(){
							newprojectname = $("#newprojectname").val();
							if(newprojectname == "" || newprojectdir == ""){
								showAlert("Incomplete Information", "Both Project Name and Project Directory must be set.");
								$("#newprojectname").focus();
							}else{
							
								if(fs.existsSync(newprojectdir + "\\WTMProject.wtm")){
									showAlert("Invalid Directory", "This directory has been used for another project. Please choose another directory.");
								}else{
									showDim("Please Wait...");
								
									setTimeout(function(){
										var initialProjectData = {
											"title" : newprojectname,
											"panoramas" : [ { panofile : "testpanorama.jpg", hotspots : [] }],
											"settings" : {
												"loadingtext" : "Loading...",
												"firstpanorama" : "testpanorama.jpg",
											},
										};
										currentprojectdata = initialProjectData;
										fs.writeFile(newprojectdir + "/WTMProject" + projectext, JSON.stringify(initialProjectData), function (err) {
											if (err) return console.log(err);
											console.log('Tadaaaa! New project is created!');

											const srcDir = "./resources/panotemplate";
											const destDir = newprojectdir;
											fse.copySync(srcDir, destDir);
											
										});
										
										//Preparing initial HTML
										setTimeout(function(){
											fs.readFile(newprojectdir + "/index.html", 'utf8', function (err, data) {
												if (err) { return console.log(err); }
												newhtml = data;
												var newhtml = data.replace("<title>TITLE</title>", "<title>" +newprojectname+ "</title>");
												data = newhtml;
												var newhtml = data.split("/*panoramas*/")[0] +"/*panoramas*/\n\r"+ generatePanoramas(initialProjectData.panoramas) +"\n\r/*panoramas-end*/"+ data.split("/*panoramas-end*/")[1];
												fs.writeFile(newprojectdir + "/index.html", newhtml, function (err) {
													if (err) return console.log(err);
													console.log('Project title is set!');		
													
													wtmdata.projects.push({ 
														projectdir : newprojectdir.replace(/\\/g, "/"),
														projectname : newprojectname
													});
													
													saveWtmdata();
													loadRecentProjects();
													
													//Preview the Project
													editproject(wtmdata.projects.length-1);
													
													hideDim();
													
													$("#newprojectname").val("").focus();
													$("#newprojectdir").html("");
													newprojectname = "";
													newprojectdir = "";
													
												});
											});
										}, 3000);
									}, 1000);
								}
								
							}
						}
					</script>
				</div>
				<div style="display: table-cell; vertical-align: top; padding-left: 20px;">
					<h2><i class="fa fa-briefcase"></i> Recent Projects</h2>
					<div id="recentprojects"></div>
				</div>
			</div>			
		</div>
		
		<!-- Project Editor -->
		<div class="page" id="projecteditor">
			<div style="display: table; width: 100%; table-layout: fixed;">
				<div style="display: table-cell; vertical-align: top; width: 50px; vertical-align: middle;">
					<a href="#" onclick="showpage('projects')"><i class="fa fa-chevron-left" style="font-size: 30px;"></i></a>
				</div>
				<div style="display: table-cell; vertical-align: top;">
					<div style="font-size: 20px;"><i class="fa fa-briefcase" style="width: 20px;"></i> <input id="currentprojecttitle" style="display: inline-block; width: 300px; color: #cccccc; font-size: 20px; font-weight: normal; margin-bottom: 5px; border: none;"onkeyup="renamecurrentproject()"></div>
					<p id="currentprojectdir" style='font-size: 12px; color: #eba576; font-style: italic; cursor: pointer;'></p>
				</div>
				<div style="display: table-cell; vertical-align: middle; width: 100px; text-align: right;">
					<div class="greenbutton" style="margin: 0px; padding: 10px; font-size: 12px;" id="currentprojectrunbutton"><i class="fa fa-play"></i></div>
				</div>
			</div>
			<div style="display: table; width: 100%; table-layout: fixed; margin-top: 30px;">
				<div style="display: table-cell; vertical-align: top; width: 200px; overflow-x: hidden;">
					<div class="editortab" onclick="showeditorc('panoramas')"><i class="fa fa-camera" style="width: 20px;"></i> Panoramas</div>
					<div class="editortab" onclick="showeditorc('hotspots')"><i class="fa fa-circle-thin" style="width: 20px;"></i> Hotspots</div>
					<div class="editortab" onclick="showeditorc('imageassets')"><i class="fa fa-image" style="width: 20px;"></i> Image Assets</div>
					<div class="editortab" onclick="showeditorc('videos')"><i class="fa fa-film" style="width: 20px;"></i> Video Files</div>
					<div class="editortab" onclick="showeditorc('audios')"><i class="fa fa-music" style="width: 20px;"></i> Audio Files</div>
					<div class="editortab" onclick="showeditorc('pdfs')"><i class="fa fa-file-pdf-o" style="width: 20px;"></i> PDF Documents</div>
					<div class="editortab" onclick="showeditorc('settings')"><i class="fa fa-cog" style="width: 20px;"></i> Settings</div>
				</div>
				<div style="display: table-cell; vertical-align: top; padding-left: 20px;">
					<div id="editorcontent" style="height: 400px; overflow: auto;"></div>
				</div>
			</div>
		</div>
		
		<!-- loading and alert dim -->
		<div id="dim">
			<div style="display: table-cell; vertical-align: middle; text-align: center;">
				<div class="lds-hourglass" id="loading"></div>
				<h3 id="dimmessage"></h3>
			</div>
		</div>
		
		<!-- top menu dim -->
		<div id="topmenudim"></div>
		
		<div style="position: fixed; right: 0; bottom: 0; padding: 10px;"><a href="https://paypal.me/habibieamrullah" target="_blank"><img src="paypalwhite.png" style="width: 64px;"></a></div>
		
		<script>

			var wtmdata = {
				projects : [],
			};
			
			if(localStorage.getItem("wtmdata") === null){
				saveWtmdata();
			}else{
				loadWtmdata();
			}
			
			function saveWtmdata(){
				localStorage.setItem("wtmdata", JSON.stringify(wtmdata));
			}
			
			function loadWtmdata(){
				wtmdata = JSON.parse(localStorage.getItem("wtmdata"));
			}
			
			function loadRecentProjects(){
				$("#recentprojects").html("");
				if(wtmdata.projects.length > 0){
					for(var i = 0; i < wtmdata.projects.length; i++){
						if (fs.existsSync(wtmdata.projects[i].projectdir)) {
							
							$("#recentprojects").prepend("<div class='projectlist'><div style='cursor: pointer;' onclick='editproject("+i+")'><div style='font-size: 20px;'>" +wtmdata.projects[i].projectname+ "</div><div style='font-size: 12px; color: #eba576;'>" +wtmdata.projects[i].projectdir+ "</div></div><div class='button' style='margin-bottom: 0px; font-size: 10px;' onclick=showInExplorer(" +i+ ")><i class='fa fa-folder'></i> Show in Explorer</div><div class='redbutton' style='margin-bottom: 0px; font-size: 10px;' onclick=removeFromProjectList(" +i+ ")><i class='fa fa-trash'></i> Remove from list</div></div>");
							
						}else{
							
							$("#recentprojects").prepend("<div class='projectlist'><div style='color: #e76d6d; font-style: italic;'><div style='font-size: 20px;'><i class='fa fa-warning'></i> " +wtmdata.projects[i].projectname+ " (Not Found)</div><div style='font-size: 12px; color: #e76d6d;'>" +wtmdata.projects[i].projectdir+ "</div></div><div class='redbutton' style='margin-bottom: 0px; font-size: 10px;' onclick=removeFromProjectList(" +i+ ")><i class='fa fa-trash'></i> Remove from list</div></div>");
							
						}
					}
					$(".projectlist").hide();
					var num = 0;
					$(".projectlist").each(function(){
						$(".projectlist").eq(num).delay(num * 100).fadeIn();
						num++;
					});
					limitHeight();
				}else{
					$("#recentprojects").html("No project found.");
				}
			}
			
			function removeFromProjectList(index){
				showYesNoAlert("Are you sure?", "Remove this project from the Project list? You will need to remove the directory from your hard drive manually to completely delete it from your computer.", function(){
					wtmdata.projects.splice(index, 1);
					saveWtmdata();
					loadRecentProjects();
				});
			}
			
			function showInExplorer(idx){
				
				var dir = wtmdata.projects[idx].projectdir;
				
				if(dir.indexOf(" ") > -1){
					showAlert("White Space Problem", "This project folder contains white space(s). Please manually explore and find it on your computer:<br>" + dir);
				}else{
					console.log("Trying to open in dir: " + dir);
					require('child_process').exec('start "" ' + dir);
				}
			}
			
			function isProjectExist(title, dir){
				for(var i = 0; i < wtmdata.projects.length; i++){
					if(wtmdata.projects[i].projectdir == dir)
						return true;
				}
				return false;
			}
			
			loadRecentProjects();
			
			function previewProject(idx){
				generateHTMLPanoramas();
				showDim("Building...");
				setTimeout(function(){
					var ppath = wtmdata.projects[idx].projectdir + "/index.html";
					var newwin = new BrowserWindow({ width: 1280, height : 720, title : "Project Preview" });
					newwin.loadFile(ppath);
					newwin.removeMenu();
					newwin.webContents.openDevTools();
					hideDim();
				}, 2000);
			}
			
			function generatePanoramas(arr){
				var pdata = "";
				if(arr.length > 0){
					for(var i = 0; i < arr.length; i++){
						var panovar = arr[i].panofile.split(".")[0];
						pdata += "var "+panovar+" = new PANOLENS.ImagePanorama( \"panoramas/" + arr[i].panofile + "\" );\n\
						"+panovar+".addEventListener('progress', function(e){\n\
							$(\"#loading\").show();\n\
						});\n\
						"+panovar+".addEventListener('load', function(e){\n\
							$(\"#loading\").fadeOut();\n\
						});\n\
						"+panovar+".addEventListener('click', function(e){\n\
						});\n\r\n\r";
						
						for( var x = 0; x < arr[i].hotspots.length; x++){
							
							var hicon = "imgs/hotspot.png";
							if(arr[i].hotspots[x].icon != undefined){
								if(arr[i].hotspots[x].icon != ""){
									hicon = arr[i].hotspots[x].icon;
								}
							}
							
							//pdata += "var infospot"+panovar+x+" = new PANOLENS.Infospot( 600, '"+hicon+"', false );\n\
							//pdata += "var infospot"+panovar+x+" = new PANOLENS.Infospot( 512, PANOLENS.DataImage.Arrow, true );\n\
							pdata += "var infospot"+panovar+x+" = new PANOLENS.Infospot( 512, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAECCAYAAAARugltAAAACXBIWXMAAAsTAAALEwEAmpwYAAAK92lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzYwLCAyMDIwLzAyLzEzLTAxOjA3OjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjYwOTZiMDYzLTA1ZTktNmY0Zi1hMDc5LWE5ZjYwZjhjYjczMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpiMzZjZjQ1My1mODFjLTVmNGEtYTBiNC00NTcyZWM4M2VhNzQiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0iNkRDNjQyNDYyMzgzMDJGNjhCQUYwQjQxNkU1OTg4ODQiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTEyLTAyVDE0OjI3OjA5KzA3OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMS0wMS0wMVQxNTozODoyNiswNzowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMS0wMS0wMVQxNTozODoyNiswNzowMCIgdGlmZjpJbWFnZVdpZHRoPSI2NTAiIHRpZmY6SW1hZ2VMZW5ndGg9IjY1NSIgdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPSIyIiB0aWZmOlNhbXBsZXNQZXJQaXhlbD0iMyIgdGlmZjpYUmVzb2x1dGlvbj0iNzIvMSIgdGlmZjpZUmVzb2x1dGlvbj0iNzIvMSIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpFeGlmVmVyc2lvbj0iMDIzMSIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249IjY1MCIgZXhpZjpQaXhlbFlEaW1lbnNpb249IjY1NSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjhhOGQ5N2MwLTk5Y2MtZjU0Mi05NmYzLTg3NDE1ZWFmYjljOCIgc3RFdnQ6d2hlbj0iMjAyMC0xMi0wMlQxNDoyODoyNSswNzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjb252ZXJ0ZWQiIHN0RXZ0OnBhcmFtZXRlcnM9ImZyb20gaW1hZ2UvanBlZyB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImRlcml2ZWQiIHN0RXZ0OnBhcmFtZXRlcnM9ImNvbnZlcnRlZCBmcm9tIGltYWdlL2pwZWcgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphNDI0MTRhOS1kMjlmLWE0NGUtYTQ1OC03MjlkOWExMWY2YzkiIHN0RXZ0OndoZW49IjIwMjAtMTItMDJUMTQ6Mjg6MjUrMDc6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMS4xIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YjM2Y2Y0NTMtZjgxYy01ZjRhLWEwYjQtNDU3MmVjODNlYTc0IiBzdEV2dDp3aGVuPSIyMDIxLTAxLTAxVDE1OjM4OjI2KzA3OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjEuMSAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjhhOGQ5N2MwLTk5Y2MtZjU0Mi05NmYzLTg3NDE1ZWFmYjljOCIgc3RSZWY6ZG9jdW1lbnRJRD0iNkRDNjQyNDYyMzgzMDJGNjhCQUYwQjQxNkU1OTg4ODQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0iNkRDNjQyNDYyMzgzMDJGNjhCQUYwQjQxNkU1OTg4ODQiLz4gPHBob3Rvc2hvcDpEb2N1bWVudEFuY2VzdG9ycz4gPHJkZjpCYWc+IDxyZGY6bGk+NkRDNjQyNDYyMzgzMDJGNjhCQUYwQjQxNkU1OTg4ODQ8L3JkZjpsaT4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6NjA5NmIwNjMtMDVlOS02ZjRmLWEwNzktYTlmNjBmOGNiNzMzPC9yZGY6bGk+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+IDx0aWZmOkJpdHNQZXJT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', true );\n\
							infospot"+panovar+x+".position.set( "+arr[i].hotspots[x].position+" );\n\
							"+panovar+".add(infospot"+panovar+x+");\n\r";
							
							//Does it have hover text?
							if(arr[i].hotspots[x].stoh != undefined && arr[i].hotspots[x].stoh == 1){
								pdata += "infospot"+panovar+x+".addHoverText( '"+arr[i].hotspots[x].title+"' );\n\r"
							}
							
							//Lets check if the infospot has actions in it
							if(arr[i].hotspots[x].actions.length > 0){
								var cactions = arr[i].hotspots[x].actions;
								for(var y = 0; y < cactions.length; y++){
									//If it is opening another Panorama
									if(cactions[y].type == 0){
										var targetpanorama = cactions[y].target.split(".")[0];
										targetpanorama = targetpanorama.split("/")[1];
										pdata += "infospot"+panovar+x+".addEventListener( 'click', function(){\n\
											viewer.setPanorama( "+targetpanorama+" );\n\
										});\n\r";
									}
								}
							}
							
							/*
							//Entoooooottt, problem nomor 2 lagi
							if(x == 1){
								var hicon = "imgs/hotspot.png";
								if(arr[i].hotspots[x].icon != undefined){
									if(arr[i].hotspots[x].icon != ""){
										hicon = arr[i].hotspots[x].icon;
									}
								}
								
								pdata += "var infospot"+panovar+x+" = new PANOLENS.Infospot( 500, '"+hicon+"', true );\n\
								infospot"+panovar+x+".position.set( "+arr[i].hotspots[x].position+" );\n\
								setTimeout(function(){ "+panovar+".add(infospot"+panovar+x+"); }, 2000);\n\r";
								
								//Does it have hover text?
								if(arr[i].hotspots[x].stoh != undefined && arr[i].hotspots[x].stoh == 1){
									pdata += "infospot"+panovar+x+".addHoverText( '"+arr[i].hotspots[x].title+"' );\n\r"
								}
								
								//Lets check if the infospot has actions in it
								
								if(arr[i].hotspots[x].actions.length > 0){
									var cactions = arr[i].hotspots[x].actions;
									for(var y = 0; y < cactions.length; y++){
										//If it is opening another Panorama
										if(cactions[y].type == 0){
											var targetpanorama = cactions[y].target.split(".")[0];
											targetpanorama = targetpanorama.split("/")[1];
											pdata += "infospot"+panovar+x+".addEventListener( 'click', function(){\n\
												viewer.setPanorama( "+targetpanorama+" );\n\
											});\n\r";
										}
									}
								}
							}
							*/
							
						}
						
						
						//Adding the infospot to the stage
						pdata += "viewer.add( "+panovar+" );\n\r";
						console.log("JS Code for this panorama has been added: " + panovar);
					}
					
					pdata += "$(document).ready(function(){ viewer.setPanorama( "+currentprojectdata.settings.firstpanorama.split(".")[0]+" ); });\n";
					
				}
				return pdata;
			}
			
			function hideDim(){
				$("#dim").fadeOut();
				$("#loading").hide();
			}
			
			function showDim(message){
				$("#dimmessage").html(message);
				$("#dim").show();
				$("#loading").show();
			}
			
			function showAlert(title, message){
				$("#dimmessage").html("<div style='width: 70%; max-width: 400px; margin: 0 auto;'><div style='background-color: #2c3643; color: white; padding: 10px;'><i class='fa fa-info-circle'></i> " +title+ "</div><div style='padding: 30px; background-color: #3d4855; font-size: 14px; font-weight: normal;'><div>" +message+ "</div><button onclick='hideDim()' style='margin-top: 20px; margin-bottom: 0px;'><i class='fa fa-times'></i> Close</button></div></div>");
				$("#dim").show();
				$("#loading").hide();
			}
			
			function showImage(title, image){
				$("#dimmessage").html("<div style='width: 70%; margin: 0 auto;'><div style='background-color: #2c3643; color: white; padding: 10px;'><i class='fa fa-image'></i> " +title+ "</div><div style='padding: 30px; background-color: #3d4855; font-size: 14px; font-weight: normal; overflow: hidden;'><div style='text-align: center; overflow: hidden;'><img src='"+image+"' style='display: inline-block; height: 100%; max-height: 400px;'></div><button onclick='hideDim()' style='margin-top: 20px; margin-bottom: 0px;'><i class='fa fa-times'></i> Close</button></div></div>");
				$("#dim").show();
				$("#loading").hide();
			}
			
			var doit;
			function showYesNoAlert(title, message, fn){
				$("#dimmessage").html("<div style='width: 70%; max-width: 400px; margin: 0 auto;'><div style='background-color: #2c3643; color: white; padding: 10px;'><i class='fa fa-question-circle'></i> " +title+ "</div><div style='padding: 30px; background-color: #3d4855; font-size: 14px; font-weight: normal;'><div>" +message+ "</div><button onclick='doit(); hideDim();' style='margin-top: 20px; margin-bottom: 0px; margin-right: 10px;'><i class='fa fa-check'></i> Yes</button><button onclick='hideDim()' style='margin-left: 10px; margin-top: 20px; margin-bottom: 0px;'><i class='fa fa-times'></i> No</button></div></div>");
				$("#dim").show();
				$("#loading").hide();
				
				doit = function(){
					fn();
				}
			}
			
			function showItemChooser(cid, title, dir, fn){
				
				doit = function(){fn()};
			
				var itemstochoose = "";
				var workingdir = wtmdata.projects[currentprojectindex].projectdir + "/" + dir + "/";
					if (!fs.existsSync(workingdir)){
						fs.mkdirSync(workingdir);
					}
					function extokay(dir, ext){
						if(dir == "images"){
							if(ext == "jpg" || ext == "jpeg" || ext == "png")
								return true;
						}else if(dir == "panoramas"){
							if(ext == "jpg" || ext == "jpeg" || ext == "png")
								return true;
						}else if(dir == "videos"){
							if(ext == "mp4")
								return true;
						}else if(dir == "audios"){
							if(ext == "mp3")
								return true;
						}else if(dir == "pdf"){
							if(ext == "pdf")
								return true;
						}else{
							return false;
						}
					}
					
					function fthumb(fname){
						var ext = fname.split(".")[fname.split(".").length-1];
						if( ext == "jpg" || ext == "jpeg" || ext == "png" ){
							return "<div style='margin-bottom: 10px;'><img src='" + workingdir + "/" + fname + "' style='height: 96px'></div>";
						}else if(ext == "mp4"){
							return "<div style='margin-bottom: 10px;'><i class='fa fa-film' style='font-size: 60px;'></i></div>";
						}else if(ext == "mp3"){
							return "<div style='margin-bottom: 10px;'><i class='fa fa-music' style='font-size: 60px;'></i></div>";
						}else if(ext == "pdf"){
							return "<div style='margin-bottom: 10px;'><i class='fa fa-file-pdf-o' style='font-size: 60px;'></i></div>";
						}
					}
					
					fs.readdirSync(workingdir).forEach(file =>{
					
						if(extokay(dir, file.split(".")[file.split(".").length-1])){
							itemstochoose += "<div onclick='setChosenItem(\""+cid+"\", \""+dir+"/"+file+"\")' style='display: inline-block; margin-right: 10px; margin-bottom: 10px; text-align: center; cursor: pointer;'><div>" + fthumb(file) + "</div><div style='font-size: 10px;'>" + truncate(file, 20) + "</div></div>";
						}
						
						
					});
				
				$("#dimmessage").html("").html("<div style='width: 100%; max-width: 720px; height: 100%; margin: 0 auto;'><div style='background-color: #2c3643; color: white; padding: 10px;'><i class='fa fa-question-circle'></i> " +title+ "</div><div style='padding: 30px; background-color: #3d4855; font-size: 14px; font-weight: normal;'><div style='box-sizing: border-box; width: 100%; height: "+(innerHeight-400)+"px; overflow: auto;'>"+itemstochoose+"</div><button onclick='hideDim()' style='margin-left: 10px; margin-top: 20px; margin-bottom: 0px;'><i class='fa fa-times'></i> Close</button></div></div>");
				$("#dim").show();
				$("#loading").hide();
			}
			
			//Set choosing item for our need, after showing the item chooser
			function setChosenItem(cid, file){
				tempSourceFile = file;
				doit();
			}
			
			function showMiniPage(type){
				switch (type){
					case "about" :
						showAlert("About", "<h1>3Sixty Web Tour Maker</h1><h3>Version 1.0.0</h3><p><br><a href='#' onclick=showMiniPage('donate')>Support The Development</a><br><a href='#'>Terms and Conditions</a><br><a href='https://3sixty.webappdev.my.id/'>Visit the Web</a></p><p>3Sixty Web Tour Maker is made with:</p><div style='background-color: white;'><img src='poweredby.png' style='width: 100%;'></div>");
						break;
					case "donate" :
						showAlert("Support The Development", "<p><img src='paypal.png' style='background-color: white; padding: 20px;'></p><p>This software is made for you for free. However, I expect any amount donations from users like you to keep me supported for maintenance and further development of this software.</p><p>Please send your donation to my PayPal account here: <a href='https://paypal.me/habibieamrullah'>https://paypal.me/habibieamrullah</a></p>");
						break;
				}
			}
			
			hideDim();
			
			function quitprogram(){
				console.log("Metusik");
				ipcRenderer.send("quitprogram");
			}
			
			function minimize(){
				var currentWindow = BrowserWindow.getFocusedWindow();
				currentWindow.minimize();
			}
			
			function maximize(){
				var window = BrowserWindow.getFocusedWindow();
				if(window.isMaximized()){ 
					window.unmaximize(); 
					$(".minmaxbutton").html("<i class='fa fa-window-maximize'></i>");
				}else{ 
					window.maximize(); 
					$(".minmaxbutton").html("<i class='fa fa-window-restore'></i>");
				}
			}
			
			function showpage(pid){
				$(".page").hide();
				$("#" + pid).fadeIn();
				switch(pid){
					case "projects" :
						loadRecentProjects();
						break;
				}
			}
			
			//Function to generate random characters
			function randomblah(length){
				var result = '';
				var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
				var charactersLength = characters.length;
				for ( var i = 0; i < length; i++ ) {
				result += characters.charAt(Math.floor(Math.random() * charactersLength));
				}
				return result;
			}
			
			//Function to truncate string
			function truncate(str, n){
				return (str.length > n) ? str.substr(0, n-1) + '&hellip;' : str;
			};
			
			var currentprojectindex;
			var currentpanoramaindex;
			var currentprojectdata;
			var tempstring; 
			var tempTimeout;
			function editproject(idx){
				currentprojectindex = idx;
				showpage("projecteditor");
				$("#currentprojecttitle").val(wtmdata.projects[idx].projectname);
				$("#currentprojectdir").html("<i class='fa fa-folder' style='width: 30px;'></i>" + wtmdata.projects[idx].projectdir).attr({ "onclick" : "showInExplorer(" + idx + ")" });
				$("#currentprojectrunbutton").attr({ "onclick" : "previewProject("+idx+")" });
				fs.readFile(wtmdata.projects[idx].projectdir + "/WTMProject.wtm", 'utf8', function (err, data) {
					if(err){
						showAlert("Project Corrupted", "Sorry this project can not be opened.");
						showpage("projects");
						return;
					}
					currentprojectdata = JSON.parse(data);
					showeditorc("panoramas");
				});
			}
			
			function showeditorc(type){
				switch(type){
					case "panoramas" :
						var panoramas = "<h2>Panorama Images</h2>";
						for(var i = 0; i < currentprojectdata.panoramas.length; i++){
							var itsmainpano = "";
							var itsmainpanogreen = "background-color: #eba576; color: black;";
							var itsmainpanoaction = " onclick='setitasmainpano(" +i+ ")'";
							var itsmainpanotrash = "";
							if(currentprojectdata.panoramas[i].panofile == currentprojectdata.settings.firstpanorama){
								itsmainpano = "<i class='fa fa-home'></i> ";
								itsmainpanogreen = "background-color: #0d9e59; color: white;";
								itsmainpanoaction = " onclick='showAlert(\"Main Panorama\", \"This panorama is already set as Main Panorama\");'";
								itsmainpanotrash = " display: none;";
							}
							panoramas += "<div class='imgthumb' style='position: relative; background: url(" + wtmdata.projects[currentprojectindex].projectdir + "/panoramas/" + currentprojectdata.panoramas[i].panofile + ") no-repeat center center; background-size: cover; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover;'><span"+itsmainpanoaction+" style='"+itsmainpanogreen+" cursor: pointer; font-weight: bold; padding: 5px; font-size: 10px;'>" + itsmainpano + truncate(currentprojectdata.panoramas[i].panofile, 15) + "</span><div style='position: absolute; bottom: 0; right: 0;'><div onclick=\"showImage('"+currentprojectdata.panoramas[i].panofile+"', '" + wtmdata.projects[currentprojectindex].projectdir+"/panoramas/"+currentprojectdata.panoramas[i].panofile + "');\" class='greenbutton'><i class='fa fa-eye'></i></div><div onclick='removePanorama(" +i+ ")' class='redbutton' style='" +itsmainpanotrash+ "'><i class='fa fa-trash'></i></div></div></div>";
						}
						$("#editorcontent").html(panoramas + "<div class='imgthumb' onclick='addpanorama()'><div style='cursor: pointer; display: table; width: 100%; height: 100%;'><div style='display: table-cell; text-align: center; vertical-align: middle;'><i class='fa fa-plus' style='font-size: 40px;'></i></div></div></div>");
						break;
					case "settings" :
						$("#editorcontent").html("<h2>Project Settings</h2><p>Project Description</p><input placeholder='Short description'><p>Tags (separate them by comma)</p><input placeholder='Tags...'><div style='display: table; width: 100%; table-layout: fixed;'><div style='display: table-cell; vertical-align: top; padding-right: 10px;'><p>Default Tour Mode</p><select><option>Normal</option><option>Cardboard</option><option>Stereoscopic</option></select><p>Panorama Loading Text</p><input id='psloadingtext' placeholder='Loading text' value='" +currentprojectdata.settings.loadingtext+ "'></div><div style='display: table-cell; vertical-align: top;'><p>Main Panorama (First panorama to load)</p><select id='firstpanorama'>" +getPanoramasNameOption()+ "</select><p>Hide Panolens Control Buttons (bottom right)</p><select><option>Yes</option><option>No</option></select></div></div><button onclick='saveProjectSettings()'><i class='fa fa-floppy-o'></i> Save</button>");
						break;
					case "hotspots" :
						var panoswithhots = "";
						for(var i = 0; i < currentprojectdata.panoramas.length; i++){
							var hotspotsofit = "";
							if(currentprojectdata.panoramas[i].hotspots.length == 0){
								hotspotsofit = "<div>There is no hotspot for this panorama.</div>";
							}else{
								for(var x = 0 ; x < currentprojectdata.panoramas[i].hotspots.length; x++){
									var cid = currentprojectdata.panoramas[i].hotspots[x].hotspotid;
									var hotspoticon = "/imgs/hotspot.png";
									
									if(currentprojectdata.panoramas[i].hotspots[x].icon != undefined){
										if(currentprojectdata.panoramas[i].hotspots[x].icon != "")
											hotspoticon = "/" + currentprojectdata.panoramas[i].hotspots[x].icon;
									}
									
									var currenthActions = "<p>This Hotspot has no action yet. Click Plus button to add an action to it.</p>";
									var hactions = currentprojectdata.panoramas[i].hotspots[x].actions;
									if(hactions.length > 0){
										currenthActions = "<p>Actions:</p>";
										for(var y = 0; y < hactions.length; y++){
											var hatype;
											if(hactions[y].type == 0){
												hatype = "Open Panorama";
											}
											var htarget = hactions[y].target.split("/")[1];
											currenthActions += "<div style='text-align: left;'><div style='font-style: italic; display: inline-block; background-color: black; color: white; padding: 5px; margin-top: 5px;'><i class='fa fa-arrow-circle-right'></i> "+hatype+"</div><div style='padding: 10px; border: 1px solid black;'><div><i class='fa fa-crosshairs'></i> " +htarget+ "</div><div style='color: gray; font-weight: bold; cursor: pointer; margin-top: 10px; display: inline-block;' onclick='removhaction("+y+", \""+cid+"\");'><i class='fa fa-trash'></i> Remove</div></div></div>";
										}
									}
									
									//custom image taek
									//hotspotsofit = "<div class='hotspotholder'><div class='hotspottitle'><input onkeyup=renameHotspotTitle("+i+","+x+") id='hinput"+cid+"' value='" +currentprojectdata.panoramas[i].hotspots[x].title+ "'></div><div style='padding: 10px; white-space: normal; display: block; box-sizing: border-box;'><div id='hotscreen"+cid+"' style='display: none;'></div><div id='hothome"+cid+"'><div onclick='changehotspoticon(\""+cid+"\");' style='width: 92px; height: 92px; margin: 0 auto; margin-bottom: 20px; background: url("+wtmdata.projects[currentprojectindex].projectdir+hotspoticon+") no-repeat center center; background-size: cover; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover;'></div><div>"+currenthActions+"</div></div></div><div><button style='min-width: 20px;' class='greenbutton' onclick='hotShowAddNewAction(\""+cid+"\")'><i class='fa fa-plus'></i> Add Action</button><button class='redbutton' style='min-width: 20px;' onclick=removehotspot('"+cid+"');><i class='fa fa-trash'></i> Del.</button></div></div>" + hotspotsofit;
									
									hotspotsofit = "<div class='hotspotholder'><div class='hotspottitle'><input onkeyup=renameHotspotTitle("+i+","+x+") id='hinput"+cid+"' value='" +currentprojectdata.panoramas[i].hotspots[x].title+ "'></div><div style='padding: 10px; white-space: normal; display: block; box-sizing: border-box;'><div id='hotscreen"+cid+"' style='display: none;'></div><div id='hothome"+cid+"'><div>"+currenthActions+"</div></div></div><div><button style='min-width: 20px;' class='greenbutton' onclick='hotShowAddNewAction(\""+cid+"\")'><i class='fa fa-plus'></i> Add Action</button><button class='redbutton' style='min-width: 20px;' onclick=removehotspot('"+cid+"');><i class='fa fa-trash'></i> Del.</button></div></div>" + hotspotsofit;
									
									// config button -> <button style='min-width: 20px;' onclick='hotShowConfigs(\""+cid+"\")'><i class='fa fa-cogs'></i> Conf.</button>
								}
							}
							
							hotspotsofit = "<div>" + hotspotsofit + "</div>";
							
							panoswithhots += "<div style='background: url(" + wtmdata.projects[currentprojectindex].projectdir + "/panoramas/" + currentprojectdata.panoramas[i].panofile + ") no-repeat center center; background-size: cover; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; margin-bottom: 20px; margin-right: 20px;'><div class='brighteronhover' style='padding: 20px;'><div style='border: 2px solid white; color: white; padding: 10px; display: inline-block; margin-bottom: 10px;'>" +currentprojectdata.panoramas[i].panofile+ "</div><div style='overflow: auto; white-space: nowrap;'>" + hotspotsofit + "</div><button style='margin: 0px; margin-top: 10px;' class='greenbutton' onclick=addNewHotspotFor("+i+")><i class='fa fa-plus-square'></i> Add New Hotspot</button></div></div>";
						}
						$("#editorcontent").html("<h2>Hotspots</h2>" + panoswithhots);
						
						break;
						
					case "imageassets" :
						var imagefiles = "";
						var workingdir = wtmdata.projects[currentprojectindex].projectdir + "/images/";
						if (!fs.existsSync(workingdir)){
							fs.mkdirSync(workingdir);
						}
						fs.readdirSync(workingdir).forEach(file =>{
							if(file.split(".")[file.split(".").length-1] == "jpg" || file.split(".")[file.split(".").length-1] == "jpeg" || file.split(".")[file.split(".").length-1] == "png"){
								imagefiles += "<div class='imgthumb' style='position: relative; background: url(" + wtmdata.projects[currentprojectindex].projectdir+"/images/"+file + ") no-repeat center center; background-size: cover; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover;'><span style='background-color: black; color: white; font-weight: bold; padding: 5px; font-size: 10px;'>" + truncate(file, 20) + "</span><div style='position: absolute; bottom: 0; right: 0;'><div onclick=\"showImage('"+file+"', '" + wtmdata.projects[currentprojectindex].projectdir+"/images/"+file + "');\" class='greenbutton'><i class='fa fa-eye'></i></div><div onclick=removeImageasset('"+wtmdata.projects[currentprojectindex].projectdir+"/images/"+file+"') class='redbutton'><i class='fa fa-trash'></i></div></div></div>";
							}
							
						});
						$("#editorcontent").html("<h2>Image Assets</h2>" + imagefiles + "<div class='imgthumb' onclick='addImageasset()'><div style='cursor: pointer; display: table; width: 100%; height: 100%;'><div style='display: table-cell; text-align: center; vertical-align: middle;'><i class='fa fa-plus' style='font-size: 40px;'></i></div></div></div>");
						
						break;
					
					case "videos" :
						var tmpfiles = "";
						var workingdir = wtmdata.projects[currentprojectindex].projectdir + "/videos/";
						if (!fs.existsSync(workingdir)){
							fs.mkdirSync(workingdir);
						}
						fs.readdirSync(workingdir).forEach(file =>{
							if(file.split(".")[file.split(".").length-1] == "mp4"){
								tmpfiles += "<div style='display: inline-block; margin-right: 20px; margin-bottom: 20px;'><div style='display: table;'><div style='background-color: #2c3643; display: table-cell; padding: 10px;'><i class='fa fa-film'></i> " + truncate(file, 30) + "</div><div class='redbutton' style='margin: 0px; padding: 10px; display: table-cell;' onclick=removeVideofile('"+wtmdata.projects[currentprojectindex].projectdir+"/videos/"+file+"')><i class='fa fa-trash'></i></div></div></div>";
							}
						});
						$("#editorcontent").html("<h2>Videos</h2><div>"+tmpfiles+"</div><div class='imgthumb' style='height: 50px; width: 250px;' onclick='addVideofile()'><div style='cursor: pointer; display: table; width: 100%; height: 100%;'><div style='display: table-cell; text-align: center; vertical-align: middle;'><i class='fa fa-plus' style='font-size: 20px;'></i> Add New File</div></div></div>");
						break;
					case "audios" :
						var tmpfiles = "";
						var workingdir = wtmdata.projects[currentprojectindex].projectdir + "/audios/";
						if (!fs.existsSync(workingdir)){
							fs.mkdirSync(workingdir);
						}
						fs.readdirSync(workingdir).forEach(file =>{
							if(file.split(".")[file.split(".").length-1] == "mp3"){
								tmpfiles += "<div style='display: inline-block; margin-right: 20px; margin-bottom: 20px;'><div style='display: table;'><div style='background-color: #2c3643; display: table-cell; padding: 10px;'><i class='fa fa-film'></i> " + truncate(file, 30) + "</div><div class='redbutton' style='margin: 0px; padding: 10px; display: table-cell;' onclick=removeAudiofile('"+wtmdata.projects[currentprojectindex].projectdir+"/audios/"+file+"')><i class='fa fa-trash'></i></div></div></div>";
							}
						});
						$("#editorcontent").html("<h2>Audios</h2><div>"+tmpfiles+"</div><div class='imgthumb' style='height: 50px; width: 250px;' onclick='addAudiofile()'><div style='cursor: pointer; display: table; width: 100%; height: 100%;'><div style='display: table-cell; text-align: center; vertical-align: middle;'><i class='fa fa-plus' style='font-size: 20px;'></i> Add New File</div></div></div>");
						break;
					case "pdfs" :
						var tmpfiles = "";
						var workingdir = wtmdata.projects[currentprojectindex].projectdir + "/pdf/";
						if (!fs.existsSync(workingdir)){
							fs.mkdirSync(workingdir);
						}
						fs.readdirSync(workingdir).forEach(file =>{
							if(file.split(".")[file.split(".").length-1] == "pdf"){
								tmpfiles += "<div style='display: inline-block; margin-right: 20px; margin-bottom: 20px;'><div style='display: table;'><div style='background-color: #2c3643; display: table-cell; padding: 10px;'><i class='fa fa-file-pdf-o'></i> " + truncate(file, 30) + "</div><div class='redbutton' style='margin: 0px; padding: 10px; display: table-cell;' onclick=removePdffile('"+wtmdata.projects[currentprojectindex].projectdir+"/pdf/"+file+"')><i class='fa fa-trash'></i></div></div></div>";
							}
						});
						$("#editorcontent").html("<h2>PDF Documents</h2><div>"+tmpfiles+"</div><div class='imgthumb' style='height: 50px; width: 250px;' onclick='addPdffile()'><div style='cursor: pointer; display: table; width: 100%; height: 100%;'><div style='display: table-cell; text-align: center; vertical-align: middle;'><i class='fa fa-plus' style='font-size: 20px;'></i> Add New File</div></div></div>");
						break;
						
				}
				
				limitHeight();
			}
			
			//HOTSPOTS Operations//
			//Show add new action dialog
			function hotShowAddNewAction(cid){
				$("#hotscreen"+cid).hide().html("<div><h4>Select Action</h4></div><select id='haction"+cid+"' onchange=showactioncontent('"+cid+"')><option>Choose one...</option><option value=1>Open Panorama</option><option value=2>Show Image</option><option value=3>Play a Video</option><option value=4>Play an Audio</option><option value=5>Open a PDF file</option><option value=6>Open URL</option><option value=7>Execute JavaScript code</option></select><div id='hotactioncontent"+cid+"'></div><div class='button' onclick=hotGoHome(\""+cid+"\") style='margin: 5px;'><i class='fa fa-floppy-o'></i> Save</div><div class='button' onclick=hotGoHome(\""+cid+"\") style='margin: 5px;'><i class='fa fa-times'></i> Close</div>").show();
				$("#hothome" + cid).hide();
			}
			
			//showactioncontent
			function showactioncontent(cid){
				var currentaction = parseInt($("#haction"+cid).val());
				var acontent = "";
				switch(currentaction){
					case 1 :
						acontent = "<p>Destination Panorama:</p><input placeholder='Click to choose...' readonly onclick='hchoose(0, \""+cid+"\");'>";
						break;
					case 2 :
						acontent = "<p>Image to open:</p><input placeholder='Click to choose...' readonly onclick='hchoose(1, \""+cid+"\");'>";
						break;
					case 3 :
						acontent = "<p>Video to play:</p><input placeholder='Click to choose...' readonly onclick='hchoose(2, \""+cid+"\");'>";
						break;
					case 4 :
						acontent = "<p>Audio to play:</p><input placeholder='Click to choose...' readonly onclick='hchoose(3, \""+cid+"\");'>";
						break;
					case 5 :
						acontent = "<p>PDF file to open:</p><input placeholder='Click to choose...' readonly onclick='hchoose(4, \""+cid+"\");'>";
						break;
					case 6 :
						acontent = "<p>URL to open:</p><input placeholder='https://example.com'>";
						break;
					case 7 :
						acontent = "<p>JavaScript code to execute:</p><textarea placeholder='Write your JS here...'></textarea>";
						break;
				}
				$("#hotactioncontent"+cid).html(acontent);
			}
			
			//Show configs panel
			function hotShowConfigs(cid){
				var projectdir = wtmdata.projects[currentprojectindex].projectdir;
				var hotspoticon = "/imgs/hotspot.png";
				var res = isCidMatched(cid);
				var currenthotspot = currentprojectdata.panoramas[res.pano].hotspots[res.hot];
				if(currenthotspot.icon != undefined && currenthotspot.icon != ""){
					hotspoticon = "/" + currenthotspot.icon;
				}
				var hotspotfilename = hotspoticon.split("/")[hotspoticon.split("/").length-1];
				var stoh = "";
				if(currenthotspot.stoh != undefined && currenthotspot.stoh == 1){
					stoh = " selected";
				}
				$("#hothome" + cid).hide();
				
				
				$("#hotscreen"+cid).hide().html("<h4>Configs</h4><p>Current Hotspot icon<br>(Click to change):</p><div onclick='changehotspoticon(\""+cid+"\");' style='width: 92px; height: 92px; margin: 0 auto; margin-bottom: 20px; background: url("+projectdir+hotspoticon+") no-repeat center center; background-size: cover; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover;'></div><input value='"+hotspotfilename+"' readonly onclick='changehotspoticon(\""+cid+"\");'><p>Show title on hover</p><select id='showtitleonhover"+cid+"' onchange='applyshowtoh(\""+cid+"\")'><option value=0>No</option><option value=1"+stoh+">Yes</option></select><p>Current Hotspot location<br>(Click the input below to change)</p><input value='"+currenthotspot.position+"' readonly><div class='button' onclick=hotGoHome(\""+cid+"\") style='margin: 5px;'><i class='fa fa-floppy-o'></i> Save</div><div class='button' onclick=hotGoHome(\""+cid+"\") style='margin: 5px;'><i class='fa fa-times'></i> Close</div>").show();
			}
			
			//Go hot home
			function hotGoHome(cid){
				$("#hothome"+cid).hide().show();
				$("#hotscreen"+cid).hide();
			}
			
			//hchoose for add actions
			function hchoose(type, cid){
				switch(type){
					case 0 :
						showItemChooser(cid, "Choose Destination Panorama", "panoramas", function(){
							var res = isCidMatched(cid);
							if(res){
								currentprojectdata.panoramas[res.pano].hotspots[res.hot].actions.push({ type : 0, target : tempSourceFile });
								console.log("Action added");
								updateWtmFile();
								showeditorc("hotspots");
								hideDim();
							}else{
								showAlert("Error", "Unable to add an action.");
							}
						});
						break;
					case 1 :
						showItemChooser(cid, "Choose an Image", "images", function(){
							showAlert("Done!", "Yessss... chosen: " + tempSourceFile);
						});
						break;
					case 2 :
						showItemChooser(cid, "Choose a Video", "videos", function(){
							showAlert("Done!", "Yessss... chosen: " + tempSourceFile);
						});
						break;
					case 3 :
						showItemChooser(cid, "Choose an Audio", "audios", function(){
							showAlert("Done!", "Yessss... chosen: " + tempSourceFile);
						});
						break;
					case 4 :
						showItemChooser(cid, "Choose a PDF", "pdf", function(){
							showAlert("Done!", "Yessss... chosen: " + tempSourceFile);
						});
						break;
				}
			}
			
			//Is Cid Matched?
			function isCidMatched(cid){
				for(var i = 0; i < currentprojectdata.panoramas.length; i++){
					for(var x = 0; x < currentprojectdata.panoramas[i].hotspots.length; x++){
						if(currentprojectdata.panoramas[i].hotspots[x].hotspotid == cid){
							return { pano : i, hot : x };
						}
					}
				}
				return false;
			}
			
			//Apply show title on hover or not
			function applyshowtoh(cid){
				//alert("Stoh: " + $("#showtitleonhover"+cid).val());
				var sthohval = parseInt($("#showtitleonhover"+cid).val());
				var res = isCidMatched(cid);
				if(sthohval == 1)
					currentprojectdata.panoramas[res.pano].hotspots[res.hot].stoh = true;
				else
					currentprojectdata.panoramas[res.pano].hotspots[res.hot].stoh = false;
				updateWtmFile();
			}
			
			//Show file chooser for hotspot
			function changehotspoticon(cid){
				showItemChooser(cid, "Choose an Image", "images", function(){
					var res = isCidMatched(cid);
					if(res){
						console.log("res value: " + JSON.stringify(res));
						currentprojectdata.panoramas[res.pano].hotspots[res.hot].icon = tempSourceFile;
						console.log("Hotspot icon has changed to: " + tempSourceFile + " for cid: " + cid);
						updateWtmFile();
						showeditorc("hotspots");
						hideDim();
					}else{
						showAlert("Error", "Unable to set Hotspot Icon");
					}
				});
			}
			
			//For deleting an action
			function removhaction(aindex, cid){
				var res = isCidMatched(cid);
				currentprojectdata.panoramas[res.pano].hotspots[res.hot].actions.splice(aindex, 1);
				updateWtmFile();
				showeditorc("hotspots");
			}
			
			//Function for dynamically renaming hotspot title
			function renameHotspotTitle(pidx, hidx){
				tempstring = $("#hinput" + currentprojectdata.panoramas[pidx].hotspots[hidx].hotspotid).val();
				//console.log(tempstring);
				clearTimeout(tempTimeout);
				tempTimeout = setTimeout(function(){
					if(tempstring != ""){
						//console.log("Hotspot renamed to: " + tempstring);
						//console.log("pidx: " + pidx + ", hidx: " + hidx);
						currentprojectdata.panoramas[pidx].hotspots[hidx].title = tempstring;
						updateWtmFile();
						//generateHTMLPanoramas();
					}
				}, 1000);
			}
			
			//Adding new hotspot
			function addNewHotspotFor(idx){
				currentpanoramaindex = idx;
				var hotpath = "./hotspotmaker.html";
				var panofile = currentprojectdata.panoramas[idx].panofile;
				var panoname = panofile.split(".")[0];
				//Let's copy current panorama file to temp panorama directory
				fse.copySync(wtmdata.projects[currentprojectindex].projectdir + "/panoramas/" + panofile, './temp/' + panofile);
				fs.readFile(hotpath, 'utf8', function (err, data) {
					if (err) { return console.log(err); }
					var newhtml = data.split("/*panoramas*/")[0] +"/*panoramas*/\n\r" + 
					"var "+panoname+" = new PANOLENS.ImagePanorama( \"temp/" + panofile + "\" );\n" +
						"viewer.add( "+panoname+" );\n" +
						panoname+".addEventListener('progress', function(e){\n" +
							"$(\"#loading\").show();\n" +
						"});\n" + 
						panoname+".addEventListener('load', function(e){\n" +
							"$(\"#loading\").fadeOut();\n" + 
						"});\n" + 
						panoname+".addEventListener('click', function(e){\n" +
						"});\n\r\n\r" +
					"\n\r/*panoramas-end*/" + data.split("/*panoramas-end*/")[1];
					fs.writeFile(hotpath, newhtml, function (err) {
						if (err) return console.log(err);
						
						var hoteditor = new BrowserWindow({ 
							width: 1280, 
							height : 720, 
							title : "Add New Hotspot", 
							webPreferences : { 
								nodeIntegration: true,
								enableRemoteModule: true,
							} 
						});
						hoteditor.loadFile(hotpath);
						hoteditor.removeMenu();
						
						hoteditor.webContents.openDevTools();
					});
				});
			}
			
			//Removing Hotspot
			function removehotspot(cid){
				showYesNoAlert("Remove Hotspot", "Are you sure to remove this Hotspot?", function(){
					var cp = currentprojectdata.panoramas;
					for(var i = 0; i < cp.length; i++){
						var cph = cp[i].hotspots;
						for(var x = 0; x < cph.length; x++){
							if(cph[x].hotspotid == cid){
								currentprojectdata.panoramas[i].hotspots.splice(x, 1);
								break;
							}
						}
					}
					updateWtmFile();
					showeditorc("hotspots");
				});
			}
			
			//Adding new image asset
			function addImageasset(){
				pointToFile(["jpg", "jpeg", "png"], function(){
					showDim("Adding new file...");
					setTimeout(function(){
						tempDestinationDirectory = wtmdata.projects[currentprojectindex].projectdir + "/images/";
						addFile(function(){
							setTimeout(function(){hideDim(); showeditorc("imageassets");},500);
						});
					}, 500);
					
				});
			}
			//Removing image asset
			function removeImageasset(f){
				showDim("Removing the file. Please wait...");
				deleteFile(f);
				setTimeout(function(){hideDim(); showeditorc("imageassets");},500);
			}
			
			//Adding new video file
			function addVideofile(){
				pointToFile(["mp4"], function(){
					showDim("Adding new file...");
					setTimeout(function(){
						tempDestinationDirectory = wtmdata.projects[currentprojectindex].projectdir + "/videos/";
						addFile(function(){
							setTimeout(function(){hideDim(); showeditorc("videos");},500);
						});
					},500);					
				});
			}
			//Removing video file
			function removeVideofile(f){
				showDim("Removing the file. Please wait...");
				deleteFile(f);
				setTimeout(function(){hideDim(); showeditorc("videos");},500);
			}
			
			//Adding new audio file
			function addAudiofile(){
				pointToFile(["mp3"], function(){
					showDim("Adding new file...");
					setTimeout(function(){
						tempDestinationDirectory = wtmdata.projects[currentprojectindex].projectdir + "/audios/";
						addFile(function(){
							setTimeout(function(){hideDim(); showeditorc("audios");},500);
						});
					},500);					
				});
			}
			//Removing audio file
			function removeAudiofile(f){
				showDim("Removing the file. Please wait...");
				deleteFile(f);
				setTimeout(function(){hideDim(); showeditorc("audios");},500);
			}
			
			//Adding new pdf file
			function addPdffile(){
				pointToFile(["pdf"], function(){
					showDim("Adding new file...");
					setTimeout(function(){
						tempDestinationDirectory = wtmdata.projects[currentprojectindex].projectdir + "/pdf/";
						addFile(function(){
							setTimeout(function(){hideDim(); showeditorc("pdfs");},500);
						});
					}, 500);
					
				});
			}
			//Removing pdf file
			function removePdffile(f){
				showDim("Removing the file. Please wait...");
				deleteFile(f);
				setTimeout(function(){hideDim(); showeditorc("pdfs");},500);
			}
			
			function setitasmainpano(idx){
				currentprojectdata.settings.firstpanorama = currentprojectdata.panoramas[idx].panofile;
				updateWtmFile();
				showeditorc("panoramas");
			}
			
			function saveProjectSettings(){
				var newtitle = $("#psloadingtext").val();
				var firstpanorama = $("#firstpanorama").val();
				currentprojectdata.settings = {
					loadingtext : newtitle,
					firstpanorama : firstpanorama,
				};
				updateWtmFile();
				fs.readFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", 'utf8', function (err, data) {
					if (err) { return console.log(err); }
					var newhtml = data.split("<!--loadingtext--\>")[0] +"<!--loadingtext--\>"+ newtitle +"<!--loadingtext-end--\>"+ data.split("<!--loadingtext-end--\>")[1];
					newhtml = newhtml.split("/*panoramas*/")[0] +"/*panoramas*/\n\r"+ generatePanoramas(currentprojectdata.panoramas) +"\n\r/*panoramas-end*/"+ data.split("/*panoramas-end*/")[1];
					fs.writeFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", newhtml, function (err) {
						if (err) return console.log(err);
						showAlert("Project Settings", "Project Settings has been updated successfully.");
						
					});
				});
			}
			
			function getPanoramasNameOption(){
				op = "";
				for(var i = 0; i < currentprojectdata.panoramas.length; i++){
					var panname = currentprojectdata.panoramas[i].panofile;
					if(panname == currentprojectdata.settings.firstpanorama)
						op += "<option selected='selected' value='"+panname+"'>" +panname+ "</option>";
					else
						op += "<option value='"+panname+"'>" +panname+ "</option>";
				}
				return op;
				
			}
			
			function addpanorama(){
				var newpanoramapath = "";
				dialog.showOpenDialog({
					properties: ['openFile'],
					filters : [{
						name : 'Images', extensions : ['jpg', 'gif'],
					}]
				}).then(result => {
					//Get the new panorama file path
					newpanoramapath = result.filePaths[0];
					if(newpanoramapath != undefined){
						console.log(newpanoramapath);
						//Renaming the file to better file name
						var newpanoramafile = newpanoramapath.split("\\")[newpanoramapath.split("\\").length-1];
						newpanoramafile = remSpaces(newpanoramafile);
						//Checking duplicate file name to avoid conflicts
						if(foundduplicatepanofile(newpanoramafile))
							newpanoramafile = newpanoramafile.split(".")[0] + randomblah(5) + "." + newpanoramafile.split(".")[newpanoramafile.split(".").length-1];
						console.log("Selected file: " + newpanoramafile);
						//Copying new panorama image to project image directory
						fse.copySync(newpanoramapath, wtmdata.projects[currentprojectindex].projectdir + '/panoramas/' + newpanoramafile);
						console.log("New panorama file copied to project directory.");
						//Pushing new panorama file name to projectdata
						currentprojectdata.panoramas.push({ panofile : newpanoramafile, hotspots : [] });
						//Write new projectdata to wtm file
						updateWtmFile();
						//Regenerate html panoramas
						//generateHTMLPanoramas();
						showDim("Please wait...");
						setTimeout(function(){
							showeditorc('panoramas');
							hideDim();
						},1000);
					}
				});
			}
			
			//Generating html for panorama changes
			function generateHTMLPanoramas(){
				fs.readFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", 'utf8', function (err, data) {
					if (err) { return console.log(err); }
					var newhtml = data.split("/*panoramas*/")[0] +"/*panoramas*/\n\r"+ generatePanoramas(currentprojectdata.panoramas) +"\n\r/*panoramas-end*/"+ data.split("/*panoramas-end*/")[1];
					fs.writeFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", newhtml, function (err) {
						if (err) return console.log(err);
						console.log("Done regenerating new HTML after adding new panorama.");
					});
				});
			}
			
			//To remove panorama
			function removePanorama(idx){
				showYesNoAlert("Remove this Panorama?", "Do you want to remove this panorama? You will also lost all the hotspots inside it.", function(){
					if(currentprojectdata.panoramas[idx].panofile == currentprojectdata.settings.firstpanorama){
						showAlert("Unable to Remove", "This panorama has been set as Main Panorama. You can not remove it unless you set another panorama file as Main Panorama.");
					}else{
						console.log("I choose to delete this panu, yeah!");
						console.log("So, remove this panu: " + currentprojectdata.panoramas[idx].panofile);
						deleteFile(wtmdata.projects[currentprojectindex].projectdir + "/panoramas/" + currentprojectdata.panoramas[idx].panofile);
						currentprojectdata.panoramas.splice(idx, 1);
						updateWtmFile();
						//generateHTMLPanoramas();
						showDim("Please wait...");
						setTimeout(function(){
							showeditorc('panoramas');
							hideDim();
						},1000);
					}
				});
			}
			
			var rnmttltimeout;
			function renamecurrentproject(){
				var newtitle = $("#currentprojecttitle").val();
				if(newtitle.length > 3){
					clearTimeout(rnmttltimeout);
					rnmttltimeout = setTimeout(function(){
						//Read existing WTM data
						fs.readFile(wtmdata.projects[currentprojectindex].projectdir + "/WTMProject.wtm", 'utf8', function (err,data) {
							if (err) {
								return console.log(err);
							}
							var projectinfo = JSON.parse(data);
							projectinfo.title = newtitle;
							//Then replace the WTM data with the updated one
							fs.writeFile(wtmdata.projects[currentprojectindex].projectdir + "/WTMProject.wtm", JSON.stringify(projectinfo), function (err) {
								if (err) return console.log(err);
									//Then re-generate the HTML accordingly
									//First read the existing HTML content
									fs.readFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", 'utf8', function (err,data){
									if (err) {
										return false;
									}							
									//Then manipulate and place the new content
									var newhtml = data.split("<title>")[0] + "<title>" +newtitle+ "</title>" + data.split("</title>")[1];
									fs.writeFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", newhtml, function (err) {
										if (err) return console.log(err);
										//If everything is done, save it!
										wtmdata.projects[currentprojectindex].projectname = newtitle;
										saveWtmdata();
										showAlert("Project Title Change", "New project title has been updated.");
									});
								});
							});
						});
					},1000);
				}
			}
			
			//Remove spaces
			function remSpaces(txt){
				//txt.replace(/\s+/g, '').toLowerCase()
				return txt.replace(/\s+/g, '');
			}
			
			//FILE SYSTEM FUNCTIONS//
			
			//FS delete file
			function deleteFile(f){
				try {
					fs.unlinkSync(f)
					//file removed
				} catch(err) {
					console.error(err)
				}
			}
			
			//Showing open dialog file with callback
			var tempSourceFile;
			var tempDestinationFileName;
			var tempDestinationDirectory;
			function pointToFile( exts, fun){
				doit = function(){
					fun();
				}
				
				dialog.showOpenDialog({
					properties: ['openFile'],
					filters : [{
						name : 'Supported Files', extensions : exts,
					}]
				}).then(result => {
					tempSourceFile = result.filePaths[0];
					if(tempSourceFile != undefined){
						tempDestinationFileName = remSpaces(tempSourceFile.split("\\")[tempSourceFile.split("\\").length-1]);
						console.log("Chosen file: " + tempDestinationFileName);
						doit();
					}else{
						console.log("Open Dialog canceled.");
					}
				});
			}
			
			//Add file with callback
			function addFile(fun){
				//source file should be the tempSourceFile and destination shud be tempDestinationDirectory + tempDestinationFileName
				doit = function(){
					fun();
				}
				//Copy the file to the destination
				fse.copySync(tempSourceFile, tempDestinationDirectory + tempDestinationFileName);
				fun();
			}
			
			//A function to check is this file name is duplicated or not
			function foundduplicatepanofile(filename){
				for(var i = 0; i < currentprojectdata.panoramas.length; i++){
					if(filename == currentprojectdata.panoramas[i].panofile)
						return true;
				}
				return false;
			}
			
			//Update the WTM File of current project
			function updateWtmFile(){
				fs.writeFile(wtmdata.projects[currentprojectindex].projectdir + "/WTMProject.wtm", JSON.stringify(currentprojectdata), function (err,data){});
				console.log("WTM File Updated.");
			}
			
			
			//fuckin messy click unclick menu blahblah
			$(".subabitem").on("click", function(){
				setTimeout(function(){
					$(".dropdown-content", this).hide();
					topmenuclicked = false;
					$("#topmenudim").hide();
				},500);
			});
			
			var topmenuclicked = false;
			$(".abitem").on("click", function(){
				$(".dropdown-content").hide();
				if(!topmenuclicked){
					$(".dropdown-content", this).show();
					topmenuclicked = true;
					$("#topmenudim").show();
				}else{
					topmenuclicked = false;
					$("#topmenudim").hide();
				}
			});
			
			$("#topmenudim, .rightbtn").on("click", function(){
				$(".dropdown-content").hide();
				topmenuclicked = false;
				$("#topmenudim").hide();
				$(".abitem").css({ "background-color" : "#2c3643" });
			});
			
			$(".abitem").not(".rightbtn").hover(function(){
				$(".dropdown-content").hide();
				$(".abitem").css({ "background-color" : "#2c3643" });
				$(this).css({ "background-color" : "#232c37" });
				if(topmenuclicked){
					$(".dropdown-content", this).show();
				}
			},function(){
				if(!topmenuclicked){
					$(".dropdown-content").hide();
					$(this).css({ "background-color" : "#2c3643" });
				}
			});
			
			$(".closebutton").hover(function(){
				$(this).css({ "background-color" : "#cf0000" });
			}, function(){
				$(this).css({ "background-color" : "#2c3643" });
			});
			
			$(".minmaxbutton, .minimizebutton").hover(function(){
				$(this).css({ "background-color" : "#0d9e59" });
			}, function(){
				$(this).css({ "background-color" : "#2c3643" });
			});
			
			$(".page").on("click", function(){
				topmenuclicked = false;
			});
			
			showpage("projects");
			
			$(document).ready(function(){
				$("body").fadeIn();
			});
			
			
			function limitHeight(){
				$("#recentprojects").css({ "height" : (innerHeight - 75) + "px", "overflow" : "auto" });
				$("#editorcontent").css({ "height" : (innerHeight-200) + "px" });
			}
			
			$(window).resize(function(){
				limitHeight();
			});
			
			//Keyboard Shortcuts
			
			$(window).keydown(function(e){
				if(e.ctrlKey && e.which == 80){
					showpage("projects");
				}
				if(e.ctrlKey && e.which == 79){
					openproject();
				}
				if(e.ctrlKey && e.which == 81){
					quitprogram();
				}
				
				if(e.ctrlKey && e.which == 84){
					showpage('tutorials')
				}
				if(e.ctrlKey && e.which == 83){
					showMiniPage('donate');
				}
				if(e.ctrlKey && e.which == 66){
					showMiniPage('about')
				}
				
				e.preventDefault;
			});
			
			//Open link in external browser
			const shell = require('electron').shell;
			// assuming $ is jQuery
			$(document).on('click', 'a[href^="http"]', function(event) {
				event.preventDefault();
				shell.openExternal(this.href);
			});
			
			//Electron Bridge
			ipcRenderer.on("setnewinfospotlocation", (event, arg)=>{
				currentprojectdata.panoramas[currentpanoramaindex].hotspots.push({ "hotspotid" : randomblah(10), "title" : arg.title, "position" : arg.position, "actions" : [] });
				updateWtmFile();
				//generateHTMLPanoramas();
				showeditorc("hotspots");
			});
			
		</script>
		
	</body>
</html>