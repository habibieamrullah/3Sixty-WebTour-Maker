<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>360 Web Tour Maker</title>
		<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
		
		<link rel="stylesheet" type="text/css" href="css/font-awesome.css">
		<link rel="stylesheet" type="text/css" href="style.css">
		
		<!-- Insert this line above script imports  -->
		<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
				
		<script src="resources/panotemplate/jquery.js"></script>
		<script src="resources/panotemplate/imagedata.js"></script>
		
		<!-- Insert this line after script imports -->
		<script>if (window.module) module = window.module;</script>
		
		<script>
			var projectext = ".wtm";
			const { dialog, BrowserWindow } = require('electron').remote;
			const { ipcRenderer } = require('electron');
			const fs = require('fs');
			const fse = require("fs-extra");
		</script>
		
	</head>
	
	<body style="display: none;">
		<div id="appbar">
			<a href="https://3sixty.webappdev.my.id"><div style="-webkit-app-region: no-drag; cursor: pointer; background-color: #0d9e59; color: white; padding: 10px; display: inline-block; font-weight: bold;">3Sixty</div></a>
			<div class="abitem">
				File
				<div class="dropdown-content">
					<div class="subabitem" onclick="showpage('projects')"><div style="display: inline-block; width: 190px;"><i class="fa fa-briefcase" style="width: 30px;"></i> Projects</div><div style="display: inline-block; color: gray;">Ctrl+P</div></div>
					<div class="subabitem" onclick="openproject()"><div style="display: inline-block; width: 190px;"><i class="fa fa-folder" style="width: 30px;"></i> Open Existing Project</div><div style="display: inline-block; color: gray;">Ctrl+O</div></div>
					<div class="subabitem" onclick="quitprogram()"><div style="display: inline-block; width: 190px;"><i class="fa fa-times" style="width: 30px;"></i> Exit</div><div style="display: inline-block; color: gray;">Ctrl+Q</div></div>
				</div>
			</div>
			<div class="abitem">
				Help
				<div class="dropdown-content">
					<div class="subabitem" onclick="showpage('tutorials')"><div style="display: inline-block; width: 190px;"><i class="fa fa-book" style="width: 30px;"></i> Tutorials</div><div style="display: inline-block; color: gray;">Ctrl+T</div></div>
					<div class="subabitem" onclick="showMiniPage('donate')"><div style="display: inline-block; width: 190px;"><i class="fa fa-paypal" style="width: 30px;"></i> Support The Dev.</div><div style="display: inline-block; color: gray;">Ctrl+S</div></div>
					<div class="subabitem" onclick="showMiniPage('about')"><div style="display: inline-block; width: 190px;"><i class="fa fa-question" style="width: 30px;"></i> About</div><div style="display: inline-block; color: gray;">Ctrl+B</div></div>					
				</div>
			</div>
			<div style="float: right;">
				<div class="abitem rightbtn minimizebutton" onclick="minimize()" style="width: 30px; text-align: center;"><i class="fa fa-window-minimize"></i></div>
				<div class="abitem rightbtn minmaxbutton" onclick="maximize()" style="width: 30px; text-align: center;"><i class="fa fa-window-restore"></i></div>
				<div class="abitem rightbtn closebutton" onclick="quitprogram()" style="width: 30px; text-align: center;"><i class="fa fa-times"></i></div>
			</div>
		</div>
		
		<!-- Tutorials -->
		<div class="page" id="tutorials">
			<h1>Tutorials</h1>
			<div style="display: table; width: 100%; table-layout: fixed;">
				<div style="display: table-cell; vertical-align: top; padding-right: 40px;">
					<h2><i class="fa fa-book"></i> Creating New Project</h2>
					<a href="https://youtu.be/ZbKQ8qHgBH8"><img src="imgs/1.png" style="width: 40%; margin-left: 20px; float: right;"></a>
					<p>To create a new project, open 3Sixty. The first scren you see is where you can start making new project. You can also click File > Projects.</p>
					<p>First you need to enter a project name. This project name will be used as your website title when it is running on web browsers.</p>
					<p>The next step is to specify a folder where you want to save your project files. Make sure you are working on a directory that is free of empty spaces. Avoid using folders like for example: C:\Users\user name\Desktop\New folder, because it has empty spaces on "user name" and "New folder".</p>
					<p>Recommended project folder path can be like this: C:\Users\David\Desktop\NewTour.</p>
					<h2><i class="fa fa-book"></i> Opening Existing project</h2>
					<p>If you already worked with this software and you want to open your pevious project, press Ctrl+O to find it on your computer. Navigate to the main project folder then click Open. If it has WTMProject.wtm in it, it will be listed on the Recent Projects list.</p>
					<p>Once your project has been listed on Recent Projects, you can click on the title to open it.</p>
					<h2><i class="fa fa-book"></i> Removing a project from Recent Projects list</h2>
					<p>You can not delete a project from 3Sixty. However, you can browse its location by clicking "Show in Explorer" then delete the files manually then click the red button "Remove from List" to remove it from the list.</p>
					<h2><i class="fa fa-book"></i> Working with Project View</h2>
					<p>By clicking a project title, you will see the Project View.</p>
					<p>Project view has three main parts, the top part that has Back button on its left, and Run button on the right. Between them you can see the Project Title. You can click on it, and rename your Project Title then automatically it will saved after a few seconds. Below the Project Title you can see directory path of current project. You can click it to reveal it on Explorer window.</p>
					<p>On the left part of main area on Project View, there are tabs: Panoramas, Hotspots, Image Assets, Video Files, Audio Files, PDF Documents and Settings. If you click one of them you will see its contents on right.</p>
					<h2><i class="fa fa-book"></i> Panoramas</h2>
					<p>Here you can add any panorama images to your project. Hit plus button to import a file. You can import normal equirectangular panorama image.</p>
					<p>Each panorama file works as a scene inside your projects. That's why you can not re-import the same panorama file twice, otherwise 3Sixty will rename it after importing it.</p>
					<p>Any imported panorama image file will be listed accordingly as a square box with image preview. Each has some buttons. At the top left part of each thumbnail you see the panorama file name. If it's marked as green it means that panorama is the main panorama that will be loaded first time when you run the tour. To make the other panoramas as main panorama, click its title and it will turned green.</p>
					<p>At bottom right corner of each panorama thumbnails there are View and Trash buttons. You can click View button to see your panorama image in full, or click Trash button to remove it from your project. However you can not delete your main panorama file, at least it needs one panorama to be there. Be careful when deleting files, make sure you are not using it in your project at all.</p>
					<h2><i class="fa fa-book"></i> Hotspots</h2>
					<p>Hotspot is a clickable element that can be placed anywhere on your 360 scene.</p><p>Each panorama that you have in your project, you can add hotspots to it.</p>
					<p>To add a hotspot, click Add New Hotspot button. Then you will see a new window to see around your 360 scene. Then press Ctrl button while clicking on an area that you wish to add the hotspot to it. Then a popup will appear. You can give it a name to make your hotspots more organised. Then click Add. Your new Hotspot has been added.</p>
					<p>You can change your hotspot icon by clicking its actual icon inside those hotspot boxes. There are some premade icons available to use. Sorry right now there is no possibility for you to use your custom image as icon. Maybe in future releases.</p>
					<p>Your new hotspot has no action yet. It means, nothing will happen if you click the hotspot when you run your project. To add an action, click Add Action button on your hotspot. Then you will see 7 hotspot action options, each one will do a specific task.</p>
					<h2><i class="fa fa-book"></i> Adding images, videos, audios and PDF documents</h2>
					<p>After Panoramas and Hotspots, the next tabs are Image Assets, Video Files, Audio Files and PDF Documents. Click any one of those then you will see a plus button to add your files.</p>
					<p>Remember currently 3Sixty supported files are limited to: jpg, jpeg and png for images; mp4 for videos, mp3 for audios; and pdf files.</p>
					<h2><i class="fa fa-book"></i> Settings</h2>
					<p>In this page you can set your project settings according your need. There are some available settings such as Project Description, Panorama Loading Text, Main Panorama to load at first time and enable or disable Panolens control Buttons on the bottom right of your virtual tour.</p>
					<h2><i class="fa fa-book"></i> Publishing</h2>
					<p>After you are finished with your project, at least you must build and run you project once to get your project files generated properly. After that, browse the project directory, copy entire files and upload it to your website. Done! That's all.</p>
					<p>For more info, please visit <a href="https://3sixty.webappdev.my.id/">the website</a>.</p>
				</div>
			</div>
		</div>
		
		<!-- What is -->
		<div class="page" id="whatis">
			<h1>What is 360 Web Tour Maker</h1>
			<p>360 Web Tour Maker is a 100% free desktop software built for you to make a 360 panorama virtual tour for web.</p>
			<p>This software is made with so many wonderful open source technologies such as HTML5, JavaScript, jQuery, three.js, panolens and so on.</p>
		</div>
		
		<!-- Projects -->
		<div class="page" id="projects">
			<h1>Projects</h1>
			<div style="display: table; width: 100%; table-layout: fixed;">
				<div style="display: table-cell; vertical-align: top; width: 30%; overflow-x: hidden;">
					<h2><i class="fa fa-pencil"></i> Create New Project</h2>
					<div>
						<p style="font-size: 12px; font-style: italic;">1. Project Name</p>
						<input id="newprojectname" placeholder="Give it a name">
					</div>
					<div>
						<p style="font-size: 12px; font-style: italic;">2. Project Directory</p>
						<p id="newprojectdir"></p>
						<button onclick="chooseprojectdir()"><i class="fa fa-folder"></i> Browse</button>
					</div>
					<div>
						<p style="font-size: 12px; font-style: italic;">3. Hit Create Button!</p>
						<button onclick="createproject()"><i class="fa fa-chevron-right"></i> Create</button>
					</div>
					
					<!--
					<h2><i class="fa fa-folder"></i> Or Open Existing Project</h2>
					<div>
						<p style="font-size: 12px; font-style: italic;">Click to browse</p>
						<button onclick="openproject()"><i class="fa fa-folder"></i> Browse</button>
					</div>
					-->
					<script>
						var newprojectname = "";
						var newprojectdir = "";
						function chooseprojectdir(){
							newprojectname = $("#newprojectname").val();
							if(newprojectname != ""){
								dialog.showOpenDialog({
									properties: ['openDirectory']
								}).then(result => {
									newprojectdir = result.filePaths[0];
									if(newprojectdir != undefined){
										$("#newprojectdir").html(newprojectdir);
									}else{
										$("#newprojectdir").html("");
										newprojectdir = "";
									}
								});
							}else{
								showAlert("Incomplete Information", "Enter your Project Name first, then specify the directory.");
								$("#newprojectname").focus();
								
							}
							
						}
						
						function openproject(){
							var openedprojectdir = "";
							dialog.showOpenDialog({
								properties: ['openDirectory']
							}).then(result => {
								openedprojectdir = result.filePaths[0];
								if(openedprojectdir != undefined){
									//showAlert("Open Project", "Is this correct: " + openedprojectdir + " ?");
									//Try to get the WTMProject.wtm file
									if(fs.existsSync(openedprojectdir + "\\WTMProject.wtm")){
										fs.readFile(openedprojectdir + "\\WTMProject.wtm", 'utf8', function (err,data) {
											if (err) {
												showAlert("Open Project", "This is NOT a valid project.");
												return console.log(err);
											}
											var openedprojecttitle = JSON.parse(data).title;
											openedprojectdir = openedprojectdir.replace(/\\/g, "/");
											
											if(isProjectExist(openedprojecttitle, openedprojectdir)){
												showAlert("Open Project", "This project already exists in Recent Projects list.");
											}else{
												//showAlert("Open Project", "Project has been successfully added to Recent Projects list.");
												wtmdata.projects.push({
													projectdir : openedprojectdir,
													projectname : openedprojecttitle,
												});
												saveWtmdata();
												loadRecentProjects();
											}
										});
									}else{
										showAlert("Open Project", "This is NOT a valid project.");
									}
								}
							});
						}
						
						function createproject(){
							newprojectname = $("#newprojectname").val();
							if(newprojectname == "" || newprojectdir == ""){
								showAlert("Incomplete Information", "Both Project Name and Project Directory must be set.");
								$("#newprojectname").focus();
							}else{
							
								if(fs.existsSync(newprojectdir + "\\WTMProject.wtm")){
									showAlert("Invalid Directory", "This directory has been used for another project. Please choose another directory.");
								}else{
									showDim("Please Wait...");
								
									setTimeout(function(){
										var initialProjectData = {
											"title" : newprojectname,
											"panoramas" : [ { panofile : "testpanorama.jpg", hotspots : [] }],
											"settings" : {
												"description" : "New 3Sixty Virtual Tour Project",
												"loadingtext" : "Loading...",
												"firstpanorama" : "testpanorama.jpg",
											},
										};
										currentprojectdata = initialProjectData;
										fs.writeFile(newprojectdir + "/WTMProject" + projectext, JSON.stringify(initialProjectData), function (err) {
											if (err) return console.log(err);
											console.log('Tadaaaa! New project is created!');

											const srcDir =  __dirname + "/resources/panotemplate";
											const destDir = newprojectdir;
											fse.copySync(srcDir, destDir);
											
										});
										
										//Preparing initial HTML
										setTimeout(function(){
											fs.readFile(newprojectdir + "/index.html", 'utf8', function (err, data) {
												if (err) { return console.log(err); }
												newhtml = data;
												var newhtml = data.replace("<title>TITLE</title>", "<title>" +newprojectname+ "</title>");
												data = newhtml;
												var newhtml = data.split("/*panoramas*/")[0] +"/*panoramas*/\n\r"+ generatePanoramas(initialProjectData.panoramas) +"\n\r/*panoramas-end*/"+ data.split("/*panoramas-end*/")[1];
												fs.writeFile(newprojectdir + "/index.html", newhtml, function (err) {
													if (err) return console.log(err);
													console.log('Project title is set!');		
													
													wtmdata.projects.push({ 
														projectdir : newprojectdir.replace(/\\/g, "/"),
														projectname : newprojectname
													});
													
													saveWtmdata();
													loadRecentProjects();
													
													//Preview the Project
													editproject(wtmdata.projects.length-1);
													
													hideDim();
													
													$("#newprojectname").val("").focus();
													$("#newprojectdir").html("");
													newprojectname = "";
													newprojectdir = "";
													
												});
											});
										}, 3000);
									}, 1000);
								}
								
							}
						}
					</script>
				</div>
				<div style="display: table-cell; vertical-align: top; padding-left: 20px;">
					<h2><i class="fa fa-briefcase"></i> Recent Projects</h2>
					<div id="recentprojects"></div>
				</div>
			</div>			
		</div>
		
		<!-- Project Editor -->
		<div class="page" id="projecteditor">
			<div style="display: table; width: 100%; table-layout: fixed;">
				<div style="display: table-cell; vertical-align: top; width: 50px; vertical-align: middle;">
					<a href="#" onclick="showpage('projects')"><i class="fa fa-chevron-left" style="font-size: 30px;"></i></a>
				</div>
				<div style="display: table-cell; vertical-align: top;">
					<div style="font-size: 20px;"><i class="fa fa-briefcase" style="width: 20px;"></i> <input id="currentprojecttitle" style="display: inline-block; width: 300px; color: #cccccc; font-size: 20px; font-weight: normal; margin-bottom: 5px; border: none;"onkeyup="renamecurrentproject()"></div>
					<p id="currentprojectdir" style='font-size: 12px; color: #eba576; font-style: italic; cursor: pointer;'></p>
				</div>
				<div style="display: table-cell; vertical-align: middle; width: 100px; text-align: right;">
					<div class="greenbutton" style="margin: 0px; padding: 10px; font-size: 12px;" id="currentprojectrunbutton"><i class="fa fa-play"></i></div>
				</div>
			</div>
			<div style="display: table; width: 100%; table-layout: fixed; margin-top: 30px;">
				<div style="display: table-cell; vertical-align: top; width: 200px; overflow-x: hidden;">
					<div class="editortab" onclick="showeditorc('panoramas')"><i class="fa fa-camera" style="width: 20px;"></i> Panoramas</div>
					<div class="editortab" onclick="showeditorc('hotspots')"><i class="fa fa-circle-thin" style="width: 20px;"></i> Hotspots</div>
					<div class="editortab" onclick="showeditorc('imageassets')"><i class="fa fa-image" style="width: 20px;"></i> Image Assets</div>
					<div class="editortab" onclick="showeditorc('videos')"><i class="fa fa-film" style="width: 20px;"></i> Video Files</div>
					<div class="editortab" onclick="showeditorc('audios')"><i class="fa fa-music" style="width: 20px;"></i> Audio Files</div>
					<div class="editortab" onclick="showeditorc('pdfs')"><i class="fa fa-file-pdf-o" style="width: 20px;"></i> PDF Documents</div>
					<div class="editortab" onclick="showeditorc('settings')"><i class="fa fa-cog" style="width: 20px;"></i> Settings</div>
				</div>
				<div style="display: table-cell; vertical-align: top; padding-left: 20px;">
					<div id="editorcontent" style="height: 400px; overflow: auto;"></div>
				</div>
			</div>
		</div>
		
		<!-- loading and alert dim -->
		<div id="dim">
			<div style="display: table-cell; vertical-align: middle; text-align: center;">
				<div class="lds-hourglass" id="loading"></div>
				<h3 id="dimmessage"></h3>
			</div>
		</div>
		
		<!-- top menu dim -->
		<div id="topmenudim"></div>
		
		<div style="position: fixed; right: 0; bottom: 0; padding: 10px;"><a href="https://paypal.me/habibieamrullah" target="_blank"><img src="imgs/paypalwhite.png" style="width: 64px;"></a></div>
		
		<script>

			var wtmdata = {
				projects : [],
			};
			
			if(localStorage.getItem("wtmdata") === null){
				saveWtmdata();
			}else{
				loadWtmdata();
			}
			
			function saveWtmdata(){
				localStorage.setItem("wtmdata", JSON.stringify(wtmdata));
			}
			
			function loadWtmdata(){
				wtmdata = JSON.parse(localStorage.getItem("wtmdata"));
			}
			
			function loadRecentProjects(){
				$("#recentprojects").html("");
				if(wtmdata.projects.length > 0){
					for(var i = 0; i < wtmdata.projects.length; i++){
						if (fs.existsSync(wtmdata.projects[i].projectdir)) {
							
							$("#recentprojects").prepend("<div class='projectlist'><div style='cursor: pointer;' onclick='editproject("+i+")'><div style='font-size: 20px;'>" +wtmdata.projects[i].projectname+ "</div><div style='font-size: 12px; color: #eba576;'>" +wtmdata.projects[i].projectdir+ "</div></div><div class='button' style='margin-bottom: 0px; font-size: 10px;' onclick=showInExplorer(" +i+ ")><i class='fa fa-folder'></i> Show in Explorer</div><div class='redbutton' style='margin-bottom: 0px; font-size: 10px;' onclick=removeFromProjectList(" +i+ ")><i class='fa fa-trash'></i> Remove from List</div></div>");
							
						}else{
							
							$("#recentprojects").prepend("<div class='projectlist'><div style='color: #e76d6d; font-style: italic;'><div style='font-size: 20px;'><i class='fa fa-warning'></i> " +wtmdata.projects[i].projectname+ " (Not Found)</div><div style='font-size: 12px; color: #e76d6d;'>" +wtmdata.projects[i].projectdir+ "</div></div><div class='redbutton' style='margin-bottom: 0px; font-size: 10px;' onclick=removeFromProjectList(" +i+ ")><i class='fa fa-trash'></i> Remove from List</div></div>");
							
						}
					}
					$(".projectlist").hide();
					var num = 0;
					$(".projectlist").each(function(){
						$(".projectlist").eq(num).delay(num * 100).fadeIn();
						num++;
					});
					limitHeight();
				}else{
					$("#recentprojects").html("No project found.");
				}
			}
			
			function removeFromProjectList(index){
				showYesNoAlert("Are you sure?", "Remove this project from the Project list? You will need to remove the directory from your hard drive manually to completely delete it from your computer.", function(){
					wtmdata.projects.splice(index, 1);
					saveWtmdata();
					loadRecentProjects();
				});
			}
			
			function showInExplorer(idx){
				
				var dir = wtmdata.projects[idx].projectdir;
				
				if(dir.indexOf(" ") > -1){
					showAlert("White Space Problem", "This project folder contains white space(s). Please manually explore and find it on your computer:<br>" + dir);
				}else{
					console.log("Trying to open in dir: " + dir);
					require('child_process').exec('start "" ' + dir);
				}
			}
			
			function isProjectExist(title, dir){
				for(var i = 0; i < wtmdata.projects.length; i++){
					if(wtmdata.projects[i].projectdir == dir)
						return true;
				}
				return false;
			}
			
			loadRecentProjects();
			
			function previewProject(idx){
				generateHTMLPanoramas();
				showDim("Building...");
				setTimeout(function(){
					var ppath = wtmdata.projects[idx].projectdir + "/index.html";
					var newwin = new BrowserWindow({ width: 1280, height : 720, title : "Project Preview", icon: "3Sixty.ico", });
					newwin.loadFile(ppath);
					newwin.removeMenu();
					//newwin.webContents.openDevTools();
					hideDim();
				}, 2000);
			}
			
			function generatePanoramas(arr){
				var pdata = "";
				if(arr.length > 0){
					for(var i = 0; i < arr.length; i++){
						var panovar = arr[i].panofile.split(".")[0];
						pdata += "var "+panovar+" = new PANOLENS.ImagePanorama( \"panoramas/" + arr[i].panofile + "\" );\n\
						"+panovar+".addEventListener('progress', function(e){\n\
							$(\"#loading\").show();\n\
						});\n\
						"+panovar+".addEventListener('load', function(e){\n\
							$(\"#loading\").fadeOut();\n\
						});\n\
						"+panovar+".addEventListener('click', function(e){\n\
						});\n\r\n\r";
						
						for( var x = 0; x < arr[i].hotspots.length; x++){
							
							var hicon = 0;
							if(arr[i].hotspots[x].icon != undefined){
								hicon = arr[i].hotspots[x].icon;
							}
							
							pdata += "var infospot"+panovar+x+" = new PANOLENS.Infospot( 512, hotspotIcons["+hicon+"].data, true );\n\
							infospot"+panovar+x+".position.set( "+arr[i].hotspots[x].position+" );\n\
							"+panovar+".add(infospot"+panovar+x+");\n\r";
							
							//Does it have hover text?
							if(arr[i].hotspots[x].stoh != undefined && arr[i].hotspots[x].stoh == 1){
								pdata += "infospot"+panovar+x+".addHoverText( '"+arr[i].hotspots[x].title+"' );\n\r";
							}
							
							pdata += "infospot"+panovar+x+".addEventListener('click', function(){\n\r";
							//Lets check if the infospot has actions in it
							if(arr[i].hotspots[x].actions.length > 0){
								var cactions = arr[i].hotspots[x].actions;
								for(var y = 0; y < cactions.length; y++){
									//If it is opening another Panorama
									var actiontype = cactions[y].type;
									if(actiontype == 0){
										var targetpanorama = cactions[y].target.split(".")[0];
										targetpanorama = targetpanorama.split("/")[1];
										pdata += "viewer.setPanorama( "+targetpanorama+" );\n\r";
									}else{
										pdata += "showMedia("+actiontype+", '"+cactions[y].target+"');\n\r";
									}
								}
								
							}
							if(arr[i].hotspots[x].url != undefined && arr[i].hotspots[x].url != ""){
								pdata += "window.open( '"+arr[i].hotspots[x].url+"', '_blank');\n\r";
							}
							if(arr[i].hotspots[x].js != undefined && arr[i].hotspots[x].js != ""){
								pdata += arr[i].hotspots[x].js + "\n\r";
							}
							pdata += "});\n\r";
							
						}
						
						
						//Adding the infospot to the stage
						pdata += "viewer.add( "+panovar+" );\n\r";
						console.log("JS Code for this panorama has been added: " + panovar);
					}
					
					pdata += "$(document).ready(function(){ viewer.setPanorama( "+currentprojectdata.settings.firstpanorama.split(".")[0]+" ); });\n";
					
				}
				return pdata;
			}
			
			function hideDim(){
				$("#dim").fadeOut();
				$("#loading").hide();
			}
			
			function showDim(message){
				$("#dimmessage").html(message);
				$("#dim").show();
				$("#loading").show();
			}
			
			function showAlert(title, message){
				$("#dimmessage").html("<div style='width: 70%; max-width: 400px; margin: 0 auto;'><div style='background-color: #2c3643; color: white; padding: 10px;'><i class='fa fa-info-circle'></i> " +title+ "</div><div style='padding: 30px; background-color: #3d4855; font-size: 14px; font-weight: normal;'><div>" +message+ "</div><button onclick='hideDim()' style='margin-top: 20px; margin-bottom: 0px;'><i class='fa fa-times'></i> Close</button></div></div>");
				$("#dim").show();
				$("#loading").hide();
			}
			
			function showImage(title, image){
				$("#dimmessage").html("<div style='width: 70%; margin: 0 auto;'><div style='background-color: #2c3643; color: white; padding: 10px;'><i class='fa fa-image'></i> " +title+ "</div><div style='padding: 30px; background-color: #3d4855; font-size: 14px; font-weight: normal; overflow: hidden;'><div style='text-align: center; overflow: hidden;'><img src='"+image+"' style='display: inline-block; height: 100%; max-height: 400px;'></div><button onclick='hideDim()' style='margin-top: 20px; margin-bottom: 0px;'><i class='fa fa-times'></i> Close</button></div></div>");
				$("#dim").show();
				$("#loading").hide();
			}
			
			var doit;
			function showYesNoAlert(title, message, fn){
				$("#dimmessage").html("<div style='width: 70%; max-width: 400px; margin: 0 auto;'><div style='background-color: #2c3643; color: white; padding: 10px;'><i class='fa fa-question-circle'></i> " +title+ "</div><div style='padding: 30px; background-color: #3d4855; font-size: 14px; font-weight: normal;'><div>" +message+ "</div><button onclick='doit(); hideDim();' style='margin-top: 20px; margin-bottom: 0px; margin-right: 10px;'><i class='fa fa-check'></i> Yes</button><button onclick='hideDim()' style='margin-left: 10px; margin-top: 20px; margin-bottom: 0px;'><i class='fa fa-times'></i> No</button></div></div>");
				$("#dim").show();
				$("#loading").hide();
				
				doit = function(){
					fn();
				}
			}
			
			function showItemChooser(cid, title, dir, fn){
				
				doit = function(){fn()};
			
				var itemstochoose = "";
				var workingdir = wtmdata.projects[currentprojectindex].projectdir + "/" + dir + "/";
					if (!fs.existsSync(workingdir)){
						fs.mkdirSync(workingdir);
					}
					function extokay(dir, ext){
						if(dir == "images"){
							if(ext == "jpg" || ext == "jpeg" || ext == "png")
								return true;
						}else if(dir == "panoramas"){
							if(ext == "jpg" || ext == "jpeg" || ext == "png")
								return true;
						}else if(dir == "videos"){
							if(ext == "mp4")
								return true;
						}else if(dir == "audios"){
							if(ext == "mp3")
								return true;
						}else if(dir == "pdf"){
							if(ext == "pdf")
								return true;
						}else{
							return false;
						}
					}
					
					function fthumb(fname){
						var ext = fname.split(".")[fname.split(".").length-1];
						if( ext == "jpg" || ext == "jpeg" || ext == "png" ){
							return "<div style='margin-bottom: 10px;'><img src='" + workingdir + "/" + fname + "' style='height: 96px'></div>";
						}else if(ext == "mp4"){
							return "<div style='margin-bottom: 10px;'><i class='fa fa-film' style='font-size: 60px;'></i></div>";
						}else if(ext == "mp3"){
							return "<div style='margin-bottom: 10px;'><i class='fa fa-music' style='font-size: 60px;'></i></div>";
						}else if(ext == "pdf"){
							return "<div style='margin-bottom: 10px;'><i class='fa fa-file-pdf-o' style='font-size: 60px;'></i></div>";
						}
					}
					
					fs.readdirSync(workingdir).forEach(file =>{
					
						if(extokay(dir, file.split(".")[file.split(".").length-1])){
							itemstochoose += "<div onclick='setChosenItem(\""+cid+"\", \""+dir+"/"+file+"\")' style='display: inline-block; margin-right: 10px; margin-bottom: 10px; text-align: center; cursor: pointer;'><div>" + fthumb(file) + "</div><div style='font-size: 10px;'>" + truncate(file, 20) + "</div></div>";
						}
						
						
					});
				
				$("#dimmessage").html("").html("<div style='width: 100%; max-width: 720px; height: 100%; margin: 0 auto;'><div style='background-color: #2c3643; color: white; padding: 10px;'><i class='fa fa-question-circle'></i> " +title+ "</div><div style='padding: 30px; background-color: #3d4855; font-size: 14px; font-weight: normal;'><div style='box-sizing: border-box; width: 100%; height: "+(innerHeight-400)+"px; overflow: auto;'>"+itemstochoose+"</div><button onclick='hideDim()' style='margin-left: 10px; margin-top: 20px; margin-bottom: 0px;'><i class='fa fa-times'></i> Close</button></div></div>");
				$("#dim").show();
				$("#loading").hide();
			}
			
			//Showing hotspot icon chooser
			function showIconChooser(cid, title){
			
				var itemstochoose = "";
				
				for(var i = 0; i < hotspotIcons.length; i++){
					itemstochoose += "<div onclick='setHotspotIcon(\""+cid+"\", "+i+")' style='display: inline-block; margin-right: 10px; margin-bottom: 10px; text-align: center; cursor: pointer;'><div><img src='" +hotspotIcons[i].data+ "' style='height: 96px;'></div><div style='font-size: 10px;'>" + hotspotIcons[i].name + "</div></div>";
				}
				
				$("#dimmessage").html("").html("<div style='width: 100%; max-width: 720px; height: 100%; margin: 0 auto;'><div style='background-color: #2c3643; color: white; padding: 10px;'><i class='fa fa-question-circle'></i> " +title+ "</div><div style='padding: 30px; background-color: #3d4855; font-size: 14px; font-weight: normal;'><div style='box-sizing: border-box; width: 100%; height: "+(innerHeight-400)+"px; overflow: auto;'>"+itemstochoose+"</div><button onclick='hideDim()' style='margin-left: 10px; margin-top: 20px; margin-bottom: 0px;'><i class='fa fa-times'></i> Close</button></div></div>");
				$("#dim").show();
				$("#loading").hide();
			}
			
			//Set chosen item after showing the item chooser
			function setChosenItem(cid, file){
				tempSourceFile = file;
				doit();
			}
			
			//Set chosen item of hotspot icon
			function setHotspotIcon(cid, idx){
				var res = isCidMatched(cid);
				currentprojectdata.panoramas[res.pano].hotspots[res.hot].icon = idx;
				updateWtmFile();
				showeditorc("hotspots");
				hideDim();
			}
			
			function showMiniPage(type){
				switch (type){
					case "about" :
						showAlert("About", "<h1>3Sixty Web Tour Maker</h1><h3>Version 1.0.0</h3><p><br><a href='#' onclick=showMiniPage('donate')>Support The Development</a><br><a href='https://3sixty.webappdev.my.id/'>Visit the Web</a></p><p>3Sixty Web Tour Maker is made with:</p><div style='background-color: white;'><img src='imgs/poweredby.png' style='width: 100%;'></div>");
						break;
					case "donate" :
						showAlert("Support The Development", "<p><img src='imgs/paypal.png' style='background-color: white; padding: 20px;'></p><p>This software is made for you for free. However, I expect any amount donations from users like you to keep me supported for maintenance and further development of this software.</p><p>Please send your donation to my PayPal account here: <a href='https://paypal.me/habibieamrullah'>https://paypal.me/habibieamrullah</a></p>");
						break;
				}
			}
			
			hideDim();
			
			function quitprogram(){
				console.log("Metusik");
				ipcRenderer.send("quitprogram");
			}
			
			function minimize(){
				var currentWindow = BrowserWindow.getFocusedWindow();
				currentWindow.minimize();
			}
			
			function maximize(){
				var window = BrowserWindow.getFocusedWindow();
				if(window.isMaximized()){ 
					window.unmaximize(); 
					$(".minmaxbutton").html("<i class='fa fa-window-maximize'></i>");
				}else{ 
					window.maximize(); 
					$(".minmaxbutton").html("<i class='fa fa-window-restore'></i>");
				}
			}
			
			function showpage(pid){
				$(".page").hide();
				$("#" + pid).fadeIn();
				switch(pid){
					case "projects" :
						loadRecentProjects();
						break;
				}
				limitHeight();
			}
			
			//Function to generate random characters
			function randomblah(length){
				var result = '';
				var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
				var charactersLength = characters.length;
				for ( var i = 0; i < length; i++ ) {
					result += characters.charAt(Math.floor(Math.random() * charactersLength));
				}
				return result;
			}
			
			//Function to truncate string
			function truncate(str, n){
				return (str.length > n) ? str.substr(0, n-1) + '&hellip;' : str;
			};
			
			var currentprojectindex;
			var currentpanoramaindex;
			var currentprojectdata;
			var tempstring; 
			var tempTimeout;
			function editproject(idx){
				currentprojectindex = idx;
				showpage("projecteditor");
				$("#currentprojecttitle").val(wtmdata.projects[idx].projectname);
				$("#currentprojectdir").html("<i class='fa fa-folder' style='width: 30px;'></i>" + wtmdata.projects[idx].projectdir).attr({ "onclick" : "showInExplorer(" + idx + ")" });
				$("#currentprojectrunbutton").attr({ "onclick" : "previewProject("+idx+")" });
				fs.readFile(wtmdata.projects[idx].projectdir + "/WTMProject.wtm", 'utf8', function (err, data) {
					if(err){
						showAlert("Project Corrupted", "Sorry this project can not be opened.");
						showpage("projects");
						return;
					}
					currentprojectdata = JSON.parse(data);
					showeditorc("panoramas");
				});
			}
			
			function showeditorc(type){
				switch(type){
					case "panoramas" :
						var panoramas = "<h2>Panorama Images</h2>";
						for(var i = 0; i < currentprojectdata.panoramas.length; i++){
							var itsmainpano = "";
							var itsmainpanogreen = "background-color: #eba576; color: black;";
							var itsmainpanoaction = " onclick='setitasmainpano(" +i+ ")'";
							var itsmainpanotrash = "";
							if(currentprojectdata.panoramas[i].panofile == currentprojectdata.settings.firstpanorama){
								itsmainpano = "<i class='fa fa-home'></i> ";
								itsmainpanogreen = "background-color: #0d9e59; color: white;";
								itsmainpanoaction = " onclick='showAlert(\"Main Panorama\", \"This panorama is already set as Main Panorama\");'";
								itsmainpanotrash = " display: none;";
							}
							panoramas += "<div class='imgthumb' style='position: relative; background: url(" + wtmdata.projects[currentprojectindex].projectdir + "/panoramas/" + currentprojectdata.panoramas[i].panofile + ") no-repeat center center; background-size: cover; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover;'><span"+itsmainpanoaction+" style='"+itsmainpanogreen+" cursor: pointer; font-weight: bold; padding: 5px; font-size: 10px;'>" + itsmainpano + truncate(currentprojectdata.panoramas[i].panofile, 15) + "</span><div style='position: absolute; bottom: 0; right: 0;'><div onclick=\"showImage('"+currentprojectdata.panoramas[i].panofile+"', '" + wtmdata.projects[currentprojectindex].projectdir+"/panoramas/"+currentprojectdata.panoramas[i].panofile + "');\" class='greenbutton'><i class='fa fa-eye'></i></div><div onclick='removePanorama(" +i+ ")' class='redbutton' style='" +itsmainpanotrash+ "'><i class='fa fa-trash'></i></div></div></div>";
						}
						$("#editorcontent").html(panoramas + "<div class='imgthumb' onclick='addpanorama()'><div style='cursor: pointer; display: table; width: 100%; height: 100%;'><div style='display: table-cell; text-align: center; vertical-align: middle;'><i class='fa fa-plus' style='font-size: 40px;'></i></div></div></div>");
						break;
					case "settings" :
						var cbsetting = "";
						if(currentprojectdata.settings.controls == 1)
							cbsetting = " selected";
						$("#editorcontent").html("<h2>Project Settings</h2><div style='display: table; width: 100%; table-layout: fixed;'><div style='display: table-cell; vertical-align: top; padding-right: 10px;'><p>Project Description</p><input placeholder='Short description' id='psdescription' value='" +currentprojectdata.settings.description+ "'><p>Panorama Loading Text</p><input id='psloadingtext' placeholder='Loading text' value='" +currentprojectdata.settings.loadingtext+ "'></div><div style='display: table-cell; vertical-align: top;'><p>Main Panorama (First panorama to load)</p><select id='firstpanorama'>" +getPanoramasNameOption()+ "</select><p>Show Panolens Control Buttons (bottom right)</p><select id='pscontrols'><option value=0>No</option><option value=1"+cbsetting+">Yes</option></select></div></div><button onclick='saveProjectSettings()'><i class='fa fa-floppy-o'></i> Save</button>");
						//<p>Default Tour Mode</p><select><option>Normal</option><option>Cardboard</option><option>Stereoscopic</option></select>
						break;
					case "hotspots" :
						var panoswithhots = "";
						for(var i = 0; i < currentprojectdata.panoramas.length; i++){
							var hotspotsofit = "";
							if(currentprojectdata.panoramas[i].hotspots.length == 0){
								hotspotsofit = "<div>There is no hotspot for this panorama.</div>";
							}else{
								for(var x = 0 ; x < currentprojectdata.panoramas[i].hotspots.length; x++){
									var cid = currentprojectdata.panoramas[i].hotspots[x].hotspotid;
									var hotspoticon = "/imgs/hotspot.png";
									
									if(currentprojectdata.panoramas[i].hotspots[x].icon != undefined){
										if(currentprojectdata.panoramas[i].hotspots[x].icon != "")
											hotspoticon = "/" + currentprojectdata.panoramas[i].hotspots[x].icon;
									}
									
									var currenthActions = "<p>This Hotspot has no action yet. Click Plus button to add an action to it.</p>";
									
									if(currentprojectdata.panoramas[i].hotspots[x].url != undefined && currentprojectdata.panoramas[i].hotspots[x].js != undefined){
										currenthActions = "";
									}
									
									if(currentprojectdata.panoramas[i].hotspots[x].url != undefined && currentprojectdata.panoramas[i].hotspots[x].url != ""){
										hatype = "Open URL";
										htarget = currentprojectdata.panoramas[i].hotspots[x].url;
										currenthActions += "<div style='text-align: left;'><div style='font-style: italic; display: inline-block; background-color: black; color: white; padding: 5px; margin-top: 5px;'><i class='fa fa-arrow-circle-right'></i> "+hatype+"</div><div style='padding: 10px; border: 1px solid black;'><div><i class='fa fa-crosshairs'></i> " +htarget+ "</div><div style='color: gray; font-weight: bold; cursor: pointer; margin-top: 10px; display: inline-block;' onclick='removhurl(\""+cid+"\");'><i class='fa fa-trash'></i> Remove</div></div></div>";
									}
									
									if(currentprojectdata.panoramas[i].hotspots[x].js != undefined && currentprojectdata.panoramas[i].hotspots[x].js != ""){
										hatype = "Execute JavaScript";
										htarget = "<span style='font-style: italic;'>Your JS Code...</span>";
										currenthActions += "<div style='text-align: left;'><div style='font-style: italic; display: inline-block; background-color: black; color: white; padding: 5px; margin-top: 5px;'><i class='fa fa-arrow-circle-right'></i> "+hatype+"</div><div style='padding: 10px; border: 1px solid black;'><div><i class='fa fa-crosshairs'></i> " +htarget+ "</div><div style='color: gray; font-weight: bold; cursor: pointer; margin-top: 10px; display: inline-block;' onclick='removhjs(\""+cid+"\");'><i class='fa fa-trash'></i> Remove</div></div></div>";
									}
									
									var hactions = currentprojectdata.panoramas[i].hotspots[x].actions;
									if(hactions.length > 0){
										currenthActions = "<p>Actions:</p>";
										for(var y = 0; y < hactions.length; y++){
											var hatype;
											var htarget = hactions[y].target.split("/")[1];
											
											if(hactions[y].type == 0){
												hatype = "Open Panorama";
											}else if(hactions[y].type == 1){
												hatype = "Show Image";
											}else if(hactions[y].type == 2){
												hatype = "Play Video File";
											}else if(hactions[y].type == 3){
												hatype = "Play Audio File";
											}else if(hactions[y].type == 4){
												hatype = "Show PDF File";
											}
											
											currenthActions += "<div style='text-align: left;'><div style='font-style: italic; display: inline-block; background-color: black; color: white; padding: 5px; margin-top: 5px;'><i class='fa fa-arrow-circle-right'></i> "+hatype+"</div><div style='padding: 10px; border: 1px solid black;'><div><i class='fa fa-crosshairs'></i> " +htarget+ "</div><div style='color: gray; font-weight: bold; cursor: pointer; margin-top: 10px; display: inline-block;' onclick='removhaction("+y+", \""+cid+"\");'><i class='fa fa-trash'></i> Remove</div></div></div>";
										}
									}
									
									var hiconidx = 0;
									if(currentprojectdata.panoramas[i].hotspots[x].icon != undefined)
										hiconidx = currentprojectdata.panoramas[i].hotspots[x].icon;
									
									hotspotsofit = "<div class='hotspotholder'><div class='hotspottitle'><input onkeyup=renameHotspotTitle("+i+","+x+") id='hinput"+cid+"' value='" +currentprojectdata.panoramas[i].hotspots[x].title+ "'></div><div style='padding: 10px; white-space: normal; display: block; box-sizing: border-box;'><div id='hotscreen"+cid+"' style='display: none;'></div><div id='hothome"+cid+"'><div onclick='changehotspoticon(\""+cid+"\");' style='width: 92px; height: 92px; margin: 0 auto; margin-top: 10px; margin-bottom: 10px; background: url("+hotspotIcons[hiconidx].data+") no-repeat center center; background-size: cover; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover;'></div><div>"+currenthActions+"</div></div></div><div><button style='min-width: 20px;' class='greenbutton' onclick='hotShowAddNewAction(\""+cid+"\")'><i class='fa fa-plus'></i> Add Action</button><button class='redbutton' style='min-width: 20px;' onclick=removehotspot('"+cid+"');><i class='fa fa-trash'></i> Del.</button></div></div>" + hotspotsofit;
									
									// config button -> <button style='min-width: 20px;' onclick='hotShowConfigs(\""+cid+"\")'><i class='fa fa-cogs'></i> Conf.</button>
								}
							}
							
							hotspotsofit = "<div>" + hotspotsofit + "</div>";
							
							panoswithhots += "<div style='background: url(" + wtmdata.projects[currentprojectindex].projectdir + "/panoramas/" + currentprojectdata.panoramas[i].panofile + ") no-repeat center center; background-size: cover; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; margin-bottom: 20px; margin-right: 20px;'><div class='brighteronhover' style='padding: 20px;'><div style='border: 2px solid white; color: white; padding: 10px; display: inline-block; margin-bottom: 10px;'>" +currentprojectdata.panoramas[i].panofile+ "</div><div style='overflow: auto; white-space: nowrap;'>" + hotspotsofit + "</div><button style='margin: 0px; margin-top: 10px;' class='greenbutton' onclick=addNewHotspotFor("+i+")><i class='fa fa-plus-square'></i> Add New Hotspot</button></div></div>";
						}
						$("#editorcontent").html("<h2>Hotspots</h2>" + panoswithhots);
						
						break;
						
					case "imageassets" :
						var imagefiles = "";
						var workingdir = wtmdata.projects[currentprojectindex].projectdir + "/images/";
						if (!fs.existsSync(workingdir)){
							fs.mkdirSync(workingdir);
						}
						fs.readdirSync(workingdir).forEach(file =>{
							if(file.split(".")[file.split(".").length-1] == "jpg" || file.split(".")[file.split(".").length-1] == "jpeg" || file.split(".")[file.split(".").length-1] == "png"){
								imagefiles += "<div class='imgthumb' style='position: relative; background: url(" + wtmdata.projects[currentprojectindex].projectdir+"/images/"+file + ") no-repeat center center; background-size: cover; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover;'><span style='background-color: black; color: white; font-weight: bold; padding: 5px; font-size: 10px;'>" + truncate(file, 20) + "</span><div style='position: absolute; bottom: 0; right: 0;'><div onclick=\"showImage('"+file+"', '" + wtmdata.projects[currentprojectindex].projectdir+"/images/"+file + "');\" class='greenbutton'><i class='fa fa-eye'></i></div><div onclick=removeImageasset('"+wtmdata.projects[currentprojectindex].projectdir+"/images/"+file+"') class='redbutton'><i class='fa fa-trash'></i></div></div></div>";
							}
							
						});
						$("#editorcontent").html("<h2>Image Assets</h2>" + imagefiles + "<div class='imgthumb' onclick='addImageasset()'><div style='cursor: pointer; display: table; width: 100%; height: 100%;'><div style='display: table-cell; text-align: center; vertical-align: middle;'><i class='fa fa-plus' style='font-size: 40px;'></i></div></div></div>");
						
						break;
					
					case "videos" :
						var tmpfiles = "";
						var workingdir = wtmdata.projects[currentprojectindex].projectdir + "/videos/";
						if (!fs.existsSync(workingdir)){
							fs.mkdirSync(workingdir);
						}
						fs.readdirSync(workingdir).forEach(file =>{
							if(file.split(".")[file.split(".").length-1] == "mp4"){
								tmpfiles += "<div style='display: inline-block; margin-right: 20px; margin-bottom: 20px;'><div style='display: table;'><div style='background-color: #2c3643; display: table-cell; padding: 10px;'><i class='fa fa-film'></i> " + truncate(file, 30) + "</div><div class='redbutton' style='margin: 0px; padding: 10px; display: table-cell;' onclick=removeVideofile('"+wtmdata.projects[currentprojectindex].projectdir+"/videos/"+file+"')><i class='fa fa-trash'></i></div></div></div>";
							}
						});
						$("#editorcontent").html("<h2>Videos</h2><div>"+tmpfiles+"</div><div class='imgthumb' style='height: 50px; width: 250px;' onclick='addVideofile()'><div style='cursor: pointer; display: table; width: 100%; height: 100%;'><div style='display: table-cell; text-align: center; vertical-align: middle;'><i class='fa fa-plus' style='font-size: 20px;'></i> Add New File</div></div></div>");
						break;
					case "audios" :
						var tmpfiles = "";
						var workingdir = wtmdata.projects[currentprojectindex].projectdir + "/audios/";
						if (!fs.existsSync(workingdir)){
							fs.mkdirSync(workingdir);
						}
						fs.readdirSync(workingdir).forEach(file =>{
							if(file.split(".")[file.split(".").length-1] == "mp3"){
								tmpfiles += "<div style='display: inline-block; margin-right: 20px; margin-bottom: 20px;'><div style='display: table;'><div style='background-color: #2c3643; display: table-cell; padding: 10px;'><i class='fa fa-film'></i> " + truncate(file, 30) + "</div><div class='redbutton' style='margin: 0px; padding: 10px; display: table-cell;' onclick=removeAudiofile('"+wtmdata.projects[currentprojectindex].projectdir+"/audios/"+file+"')><i class='fa fa-trash'></i></div></div></div>";
							}
						});
						$("#editorcontent").html("<h2>Audios</h2><div>"+tmpfiles+"</div><div class='imgthumb' style='height: 50px; width: 250px;' onclick='addAudiofile()'><div style='cursor: pointer; display: table; width: 100%; height: 100%;'><div style='display: table-cell; text-align: center; vertical-align: middle;'><i class='fa fa-plus' style='font-size: 20px;'></i> Add New File</div></div></div>");
						break;
					case "pdfs" :
						var tmpfiles = "";
						var workingdir = wtmdata.projects[currentprojectindex].projectdir + "/pdf/";
						if (!fs.existsSync(workingdir)){
							fs.mkdirSync(workingdir);
						}
						fs.readdirSync(workingdir).forEach(file =>{
							if(file.split(".")[file.split(".").length-1] == "pdf"){
								tmpfiles += "<div style='display: inline-block; margin-right: 20px; margin-bottom: 20px;'><div style='display: table;'><div style='background-color: #2c3643; display: table-cell; padding: 10px;'><i class='fa fa-file-pdf-o'></i> " + truncate(file, 30) + "</div><div class='redbutton' style='margin: 0px; padding: 10px; display: table-cell;' onclick=removePdffile('"+wtmdata.projects[currentprojectindex].projectdir+"/pdf/"+file+"')><i class='fa fa-trash'></i></div></div></div>";
							}
						});
						$("#editorcontent").html("<h2>PDF Documents</h2><div>"+tmpfiles+"</div><div class='imgthumb' style='height: 50px; width: 250px;' onclick='addPdffile()'><div style='cursor: pointer; display: table; width: 100%; height: 100%;'><div style='display: table-cell; text-align: center; vertical-align: middle;'><i class='fa fa-plus' style='font-size: 20px;'></i> Add New File</div></div></div>");
						break;
				}
				limitHeight();
			}
			
			//HOTSPOTS Operations//
			//Show add new action dialog
			function hotShowAddNewAction(cid){
				$("#hotscreen"+cid).hide().html("<div><h4>Select Action</h4></div><select id='haction"+cid+"' onchange=showactioncontent('"+cid+"')><option>Choose one...</option><option value=1>Open Panorama</option><option value=2>Show Image</option><option value=3>Play a Video</option><option value=4>Play an Audio</option><option value=5>Open a PDF file</option><option value=6>Open URL</option><option value=7>Execute JavaScript code</option></select><div id='hotactioncontent"+cid+"'></div><div class='button' onclick=showeditorc('hotspots') style='margin: 5px;'><i class='fa fa-floppy-o'></i> Save</div><div class='button' onclick=hotGoHome(\""+cid+"\") style='margin: 5px;'><i class='fa fa-times'></i> Close</div>").show();
				$("#hothome" + cid).hide();
			}
			
			//showactioncontent
			function showactioncontent(cid){
				var currentaction = parseInt($("#haction"+cid).val());
				var acontent = "";
				var res = isCidMatched(cid);				
				switch(currentaction){
					case 1 :
						acontent = "<p>Destination Panorama:</p><input placeholder='Click to choose...' readonly onclick='hchoose(0, \""+cid+"\");'>";
						break;
					case 2 :
						acontent = "<p>Image to open:</p><input placeholder='Click to choose...' readonly onclick='hchoose(1, \""+cid+"\");'>";
						break;
					case 3 :
						acontent = "<p>Video to play:</p><input placeholder='Click to choose...' readonly onclick='hchoose(2, \""+cid+"\");'>";
						break;
					case 4 :
						acontent = "<p>Audio to play:</p><input placeholder='Click to choose...' readonly onclick='hchoose(3, \""+cid+"\");'>";
						break;
					case 5 :
						acontent = "<p>PDF file to open:</p><input placeholder='Click to choose...' readonly onclick='hchoose(4, \""+cid+"\");'>";
						break;
					case 6 :
						var currenthurl = "";
						if(currentprojectdata.panoramas[res.pano].hotspots[res.hot].url != undefined)
							currenthurl = currentprojectdata.panoramas[res.pano].hotspots[res.hot].url;
						acontent = "<p>URL to open:</p><input placeholder='https://example.com' id='hactionurlinput"+cid+"' onkeyup='savehactionurl(\""+cid+"\")' value='"+currenthurl+"'>";
						break;
					case 7 :
						var currenthjs = "";
						if(currentprojectdata.panoramas[res.pano].hotspots[res.hot].js != undefined)
							currenthjs = currentprojectdata.panoramas[res.pano].hotspots[res.hot].js;
						acontent = "<p>JavaScript code to execute:</p><textarea placeholder='Write your JS here...' id='hactionjsinput"+cid+"' onkeyup='savehactionjs(\""+cid+"\")'>"+currenthjs+"</textarea>";
						break;
				}
				$("#hotactioncontent"+cid).html(acontent);
			}
			
			//Show configs panel
			function hotShowConfigs(cid){
				var projectdir = wtmdata.projects[currentprojectindex].projectdir;
				var hotspoticon = "/imgs/hotspot.png";
				var res = isCidMatched(cid);
				var currenthotspot = currentprojectdata.panoramas[res.pano].hotspots[res.hot];
				if(currenthotspot.icon != undefined && currenthotspot.icon != ""){
					hotspoticon = "/" + currenthotspot.icon;
				}
				var hotspotfilename = hotspoticon.split("/")[hotspoticon.split("/").length-1];
				var stoh = "";
				if(currenthotspot.stoh != undefined && currenthotspot.stoh == 1){
					stoh = " selected";
				}
				$("#hothome" + cid).hide();
				
				
				$("#hotscreen"+cid).hide().html("<h4>Configs</h4><p>Current Hotspot icon<br>(Click to change):</p><div onclick='changehotspoticon(\""+cid+"\");' style='width: 92px; height: 92px; margin: 0 auto; margin-bottom: 20px; background: url("+projectdir+hotspoticon+") no-repeat center center; background-size: cover; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover;'></div><input value='"+hotspotfilename+"' readonly onclick='changehotspoticon(\""+cid+"\");'><p>Show title on hover</p><select id='showtitleonhover"+cid+"' onchange='applyshowtoh(\""+cid+"\")'><option value=0>No</option><option value=1"+stoh+">Yes</option></select><p>Current Hotspot location<br>(Click the input below to change)</p><input value='"+currenthotspot.position+"' readonly><div class='button' onclick=hotGoHome(\""+cid+"\") style='margin: 5px;'><i class='fa fa-floppy-o'></i> Save</div><div class='button' onclick=hotGoHome(\""+cid+"\") style='margin: 5px;'><i class='fa fa-times'></i> Close</div>").show();
			}
			
			//Go hot home
			function hotGoHome(cid){
				$("#hothome"+cid).hide().show();
				$("#hotscreen"+cid).hide();
			}
			
			//save haction url
			function savehactionurl(cid){
				clearTimeout(tempTimeout);
				tempTimeout = setTimeout(function(){
					var urltoopen = $("#hactionurlinput"+cid).val();
					if(urltoopen.indexOf("http") > -1){
						console.log("Action URL: " + urltoopen);
						var res = isCidMatched(cid);				
						currentprojectdata.panoramas[res.pano].hotspots[res.hot].url = urltoopen;
						updateWtmFile();
					}
				}, 1000);
			}
			
			//save haction js
			function savehactionjs(cid){
				clearTimeout(tempTimeout);
				tempTimeout = setTimeout(function(){
					var jstorun = $("#hactionjsinput"+cid).val();
					if(jstorun != ""){
						console.log("Saving JS code: " + jstorun);
						var res = isCidMatched(cid);
						currentprojectdata.panoramas[res.pano].hotspots[res.hot].js = jstorun;
						updateWtmFile();
					}
				}, 1000);
			}
			
			//hchoose for add actions
			function hchoose(type, cid){
				switch(type){
					case 0 :
						showItemChooser(cid, "Choose Destination Panorama", "panoramas", function(){
							var res = isCidMatched(cid);							
							currentprojectdata.panoramas[res.pano].hotspots[res.hot].actions.push({ type : 0, target : tempSourceFile });
							console.log("Action added");
							updateWtmFile();
							showeditorc("hotspots");
							hideDim();
						});
						break;
					case 1 :
						showItemChooser(cid, "Choose an Image", "images", function(){
							var res = isCidMatched(cid);							
							currentprojectdata.panoramas[res.pano].hotspots[res.hot].actions.push({ type : 1, target : tempSourceFile });
							console.log("Action added");
							updateWtmFile();
							showeditorc("hotspots");
							hideDim();
						});
						break;
					case 2 :
						showItemChooser(cid, "Choose a Video", "videos", function(){
							var res = isCidMatched(cid);							
							currentprojectdata.panoramas[res.pano].hotspots[res.hot].actions.push({ type : 2, target : tempSourceFile });
							console.log("Action added");
							updateWtmFile();
							showeditorc("hotspots");
							hideDim();
						});
						break;
					case 3 :
						showItemChooser(cid, "Choose an Audio", "audios", function(){
							var res = isCidMatched(cid);							
							currentprojectdata.panoramas[res.pano].hotspots[res.hot].actions.push({ type : 3, target : tempSourceFile });
							console.log("Action added");
							updateWtmFile();
							showeditorc("hotspots");
							hideDim();
						});
						break;
					case 4 :
						showItemChooser(cid, "Choose a PDF", "pdf", function(){
							var res = isCidMatched(cid);							
							currentprojectdata.panoramas[res.pano].hotspots[res.hot].actions.push({ type : 4, target : tempSourceFile });
							console.log("Action added");
							updateWtmFile();
							showeditorc("hotspots");
							hideDim();
						});
						break;
				}
			}
			
			//Is Cid Matched?
			function isCidMatched(cid){
				for(var i = 0; i < currentprojectdata.panoramas.length; i++){
					for(var x = 0; x < currentprojectdata.panoramas[i].hotspots.length; x++){
						if(currentprojectdata.panoramas[i].hotspots[x].hotspotid == cid){
							return { pano : i, hot : x };
						}
					}
				}
				return false;
			}
			
			//Apply show title on hover or not
			function applyshowtoh(cid){
				//alert("Stoh: " + $("#showtitleonhover"+cid).val());
				var sthohval = parseInt($("#showtitleonhover"+cid).val());
				var res = isCidMatched(cid);
				if(sthohval == 1)
					currentprojectdata.panoramas[res.pano].hotspots[res.hot].stoh = true;
				else
					currentprojectdata.panoramas[res.pano].hotspots[res.hot].stoh = false;
				updateWtmFile();
			}
			
			//Show file chooser for hotspot
			function changehotspoticon(cid){
				showIconChooser(cid, "Choose a Hotspot Icon");
			}
			
			//For deleting an action
			function removhaction(aindex, cid){
				var res = isCidMatched(cid);
				currentprojectdata.panoramas[res.pano].hotspots[res.hot].actions.splice(aindex, 1);
				updateWtmFile();
				showeditorc("hotspots");
			}
			
			//Delete hotspot url
			function removhurl(cid){
				var res = isCidMatched(cid);
				currentprojectdata.panoramas[res.pano].hotspots[res.hot].url = undefined;
				updateWtmFile();
				showeditorc("hotspots");
			}
			
			//Delete hotspot url
			function removhjs(cid){
				var res = isCidMatched(cid);
				currentprojectdata.panoramas[res.pano].hotspots[res.hot].js = undefined;
				updateWtmFile();
				showeditorc("hotspots");
			}
			
			//Function for dynamically renaming hotspot title
			function renameHotspotTitle(pidx, hidx){
				tempstring = $("#hinput" + currentprojectdata.panoramas[pidx].hotspots[hidx].hotspotid).val();
				//console.log(tempstring);
				clearTimeout(tempTimeout);
				tempTimeout = setTimeout(function(){
					if(tempstring != ""){
						//console.log("Hotspot renamed to: " + tempstring);
						//console.log("pidx: " + pidx + ", hidx: " + hidx);
						currentprojectdata.panoramas[pidx].hotspots[hidx].title = tempstring;
						updateWtmFile();
						//generateHTMLPanoramas();
					}
				}, 1000);
			}
			
			//Adding new hotspot
			function addNewHotspotFor(idx){
				currentpanoramaindex = idx;
				var hotpath = "./hotspotmaker.html";
				var panofile = currentprojectdata.panoramas[idx].panofile;
				var panoname = panofile.split(".")[0];
				//Let's copy current panorama file to temp panorama directory
				fse.copySync(wtmdata.projects[currentprojectindex].projectdir + "/panoramas/" + panofile, './temp/' + panofile);
				fs.readFile(hotpath, 'utf8', function (err, data) {
					if (err) { return console.log(err); }
					var newhtml = data.split("/*panoramas*/")[0] +"/*panoramas*/\n\r" + 
					"var "+panoname+" = new PANOLENS.ImagePanorama( \"temp/" + panofile + "\" );\n" +
						"viewer.add( "+panoname+" );\n" +
						panoname+".addEventListener('progress', function(e){\n" +
							"$(\"#loading\").show();\n" +
						"});\n" + 
						panoname+".addEventListener('load', function(e){\n" +
							"$(\"#loading\").fadeOut();\n" + 
						"});\n" + 
						panoname+".addEventListener('click', function(e){\n" +
						"});\n\r\n\r" +
					"\n\r/*panoramas-end*/" + data.split("/*panoramas-end*/")[1];
					fs.writeFile(hotpath, newhtml, function (err) {
						if (err) return console.log(err);
						
						var hoteditor = new BrowserWindow({ 
							width: 1280, 
							height : 720, 
							title : "Add New Hotspot", 
							icon: "3Sixty.ico",
							webPreferences : { 
								nodeIntegration: true,
								enableRemoteModule: true,
							} 
						});
						hoteditor.loadFile(hotpath);
						hoteditor.removeMenu();
						
						//hoteditor.webContents.openDevTools();
					});
				});
			}
			
			//Removing Hotspot
			function removehotspot(cid){
				showYesNoAlert("Remove Hotspot", "Are you sure to remove this Hotspot?", function(){
					var cp = currentprojectdata.panoramas;
					for(var i = 0; i < cp.length; i++){
						var cph = cp[i].hotspots;
						for(var x = 0; x < cph.length; x++){
							if(cph[x].hotspotid == cid){
								currentprojectdata.panoramas[i].hotspots.splice(x, 1);
								break;
							}
						}
					}
					updateWtmFile();
					showeditorc("hotspots");
				});
			}
			
			//Adding new image asset
			function addImageasset(){
				pointToFile(["jpg", "jpeg", "png"], function(){
					showDim("Adding new file...");
					setTimeout(function(){
						tempDestinationDirectory = wtmdata.projects[currentprojectindex].projectdir + "/images/";
						addFile(function(){
							setTimeout(function(){hideDim(); showeditorc("imageassets");},500);
						});
					}, 500);
					
				});
			}
			//Removing image asset
			function removeImageasset(f){
				showDim("Removing the file. Please wait...");
				deleteFile(f);
				setTimeout(function(){hideDim(); showeditorc("imageassets");},500);
			}
			
			//Adding new video file
			function addVideofile(){
				pointToFile(["mp4"], function(){
					showDim("Adding new file...");
					setTimeout(function(){
						tempDestinationDirectory = wtmdata.projects[currentprojectindex].projectdir + "/videos/";
						addFile(function(){
							setTimeout(function(){hideDim(); showeditorc("videos");},500);
						});
					},500);					
				});
			}
			//Removing video file
			function removeVideofile(f){
				showDim("Removing the file. Please wait...");
				deleteFile(f);
				setTimeout(function(){hideDim(); showeditorc("videos");},500);
			}
			
			//Adding new audio file
			function addAudiofile(){
				pointToFile(["mp3"], function(){
					showDim("Adding new file...");
					setTimeout(function(){
						tempDestinationDirectory = wtmdata.projects[currentprojectindex].projectdir + "/audios/";
						addFile(function(){
							setTimeout(function(){hideDim(); showeditorc("audios");},500);
						});
					},500);					
				});
			}
			//Removing audio file
			function removeAudiofile(f){
				showDim("Removing the file. Please wait...");
				deleteFile(f);
				setTimeout(function(){hideDim(); showeditorc("audios");},500);
			}
			
			//Adding new pdf file
			function addPdffile(){
				pointToFile(["pdf"], function(){
					showDim("Adding new file...");
					setTimeout(function(){
						tempDestinationDirectory = wtmdata.projects[currentprojectindex].projectdir + "/pdf/";
						addFile(function(){
							setTimeout(function(){hideDim(); showeditorc("pdfs");},500);
						});
					}, 500);
					
				});
			}
			//Removing pdf file
			function removePdffile(f){
				showDim("Removing the file. Please wait...");
				deleteFile(f);
				setTimeout(function(){hideDim(); showeditorc("pdfs");},500);
			}
			
			function setitasmainpano(idx){
				currentprojectdata.settings.firstpanorama = currentprojectdata.panoramas[idx].panofile;
				updateWtmFile();
				showeditorc("panoramas");
			}
			
			function saveProjectSettings(){
				showDim("Saving project...");
				var newtitle = $("#psloadingtext").val();
				var newdescription = $("#psdescription").val();
				var firstpanorama = $("#firstpanorama").val();
				var newcontrols = parseInt($("#pscontrols").val());
				currentprojectdata.settings = {
					loadingtext : newtitle,
					firstpanorama : firstpanorama,
					description : newdescription,
					controls : newcontrols,
				};
				updateWtmFile();
				fs.readFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", 'utf8', function (err, data) {
					if (err) { return console.log(err); }
					
					//Update loading text
					var newhtml = data.split("<!--loadingtext--\>")[0] +"<!--loadingtext--\>"+ newtitle +"<!--loadingtext-end--\>"+ data.split("<!--loadingtext-end--\>")[1];
					
					//Updating panoramas (no need, as it handled separately
					//newhtml = newhtml.split("/*panoramas*/")[0] +"/*panoramas*/\n\r"+ generatePanoramas(currentprojectdata.panoramas) +"\n\r/*panoramas-end*/"+ newhtml.split("/*panoramas-end*/")[1];
					
					//Update project description
					newhtml = newhtml.split("<!--projectdescription--\>")[0] +"<!--projectdescription--\><meta name=\"description\" content=\""+newdescription+"\"><!--projectdescription-end--\>"+ newhtml.split("<!--projectdescription-end--\>")[1];
					
					//Update panolens settings
					var cbsetting = "false";
					if(newcontrols == 1)
						cbsetting = "true";
					newhtml = newhtml.split("/*panolens*/")[0] +"/*panolens*/\n\r"+ 
					"var viewer = new PANOLENS.Viewer( { container: container , controlBar: "+cbsetting+",  output: 'console' , autoHideInfospot: false, } );" +
					"\n\r/*panolens-end*/"+ newhtml.split("/*panolens-end*/")[1];
					
					fs.writeFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", newhtml, function (err) {
						if (err) return console.log(err);
						showAlert("Project Settings", "Project Settings has been updated successfully.");
					});
				});
			}
			
			function getPanoramasNameOption(){
				op = "";
				for(var i = 0; i < currentprojectdata.panoramas.length; i++){
					var panname = currentprojectdata.panoramas[i].panofile;
					if(panname == currentprojectdata.settings.firstpanorama)
						op += "<option selected='selected' value='"+panname+"'>" +panname+ "</option>";
					else
						op += "<option value='"+panname+"'>" +panname+ "</option>";
				}
				return op;
				
			}
			
			function addpanorama(){
				var newpanoramapath = "";
				dialog.showOpenDialog({
					properties: ['openFile'],
					filters : [{
						name : 'Images', extensions : ['jpg', 'gif'],
					}]
				}).then(result => {
					//Get the new panorama file path
					newpanoramapath = result.filePaths[0];
					if(newpanoramapath != undefined){
						console.log(newpanoramapath);
						//Renaming the file to better file name
						var newpanoramafile = newpanoramapath.split("\\")[newpanoramapath.split("\\").length-1];
						newpanoramafile = remSpaces(newpanoramafile);
						//Checking duplicate file name to avoid conflicts
						if(foundduplicatepanofile(newpanoramafile))
							newpanoramafile = newpanoramafile.split(".")[0] + randomblah(5) + "." + newpanoramafile.split(".")[newpanoramafile.split(".").length-1];
						console.log("Selected file: " + newpanoramafile);
						//Copying new panorama image to project image directory
						fse.copySync(newpanoramapath, wtmdata.projects[currentprojectindex].projectdir + '/panoramas/' + newpanoramafile);
						console.log("New panorama file copied to project directory.");
						//Pushing new panorama file name to projectdata
						currentprojectdata.panoramas.push({ panofile : newpanoramafile, hotspots : [] });
						//Write new projectdata to wtm file
						updateWtmFile();
						//Regenerate html panoramas
						//generateHTMLPanoramas();
						showDim("Please wait...");
						setTimeout(function(){
							showeditorc('panoramas');
							hideDim();
						},1000);
					}
				});
			}
			
			//Generating html for panorama changes
			function generateHTMLPanoramas(){
				fs.readFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", 'utf8', function (err, data) {
					if (err) { return console.log(err); }
					var newhtml = data.split("/*panoramas*/")[0] +"/*panoramas*/\n\r"+ generatePanoramas(currentprojectdata.panoramas) +"\n\r/*panoramas-end*/"+ data.split("/*panoramas-end*/")[1];
					fs.writeFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", newhtml, function (err) {
						if (err) return console.log(err);
						console.log("Done regenerating new HTML after adding new panorama.");
					});
				});
			}
			
			//To remove panorama
			function removePanorama(idx){
				showYesNoAlert("Remove this Panorama?", "Do you want to remove this panorama? You will also lost all the hotspots inside it.", function(){
					if(currentprojectdata.panoramas[idx].panofile == currentprojectdata.settings.firstpanorama){
						showAlert("Unable to Remove", "This panorama has been set as Main Panorama. You can not remove it unless you set another panorama file as Main Panorama.");
					}else{
						console.log("I choose to delete this panu, yeah!");
						console.log("So, remove this panu: " + currentprojectdata.panoramas[idx].panofile);
						deleteFile(wtmdata.projects[currentprojectindex].projectdir + "/panoramas/" + currentprojectdata.panoramas[idx].panofile);
						currentprojectdata.panoramas.splice(idx, 1);
						updateWtmFile();
						//generateHTMLPanoramas();
						showDim("Please wait...");
						setTimeout(function(){
							showeditorc('panoramas');
							hideDim();
						},1000);
					}
				});
			}
			
			var rnmttltimeout;
			function renamecurrentproject(){
				var newtitle = $("#currentprojecttitle").val();
				if(newtitle.length > 3){
					clearTimeout(rnmttltimeout);
					rnmttltimeout = setTimeout(function(){
						//Read existing WTM data
						fs.readFile(wtmdata.projects[currentprojectindex].projectdir + "/WTMProject.wtm", 'utf8', function (err,data) {
							if (err) {
								return console.log(err);
							}
							var projectinfo = JSON.parse(data);
							projectinfo.title = newtitle;
							//Then replace the WTM data with the updated one
							fs.writeFile(wtmdata.projects[currentprojectindex].projectdir + "/WTMProject.wtm", JSON.stringify(projectinfo), function (err) {
								if (err) return console.log(err);
									//Then re-generate the HTML accordingly
									//First read the existing HTML content
									fs.readFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", 'utf8', function (err,data){
									if (err) {
										return false;
									}							
									//Then manipulate and place the new content
									var newhtml = data.split("<title>")[0] + "<title>" +newtitle+ "</title>" + data.split("</title>")[1];
									fs.writeFile(wtmdata.projects[currentprojectindex].projectdir + "/index.html", newhtml, function (err) {
										if (err) return console.log(err);
										//If everything is done, save it!
										wtmdata.projects[currentprojectindex].projectname = newtitle;
										saveWtmdata();
										showAlert("Project Title Change", "New project title has been updated.");
									});
								});
							});
						});
					},1000);
				}
			}
			
			//Remove spaces
			function remSpaces(txt){
				//txt.replace(/\s+/g, '').toLowerCase()
				return txt.replace(/\s+/g, '');
			}
			
			//FILE SYSTEM FUNCTIONS//
			
			//FS delete file
			function deleteFile(f){
				try {
					fs.unlinkSync(f)
					//file removed
				} catch(err) {
					console.error(err)
				}
			}
			
			//Showing open dialog file with callback
			var tempSourceFile;
			var tempDestinationFileName;
			var tempDestinationDirectory;
			function pointToFile( exts, fun){
				doit = function(){
					fun();
				}
				
				dialog.showOpenDialog({
					properties: ['openFile'],
					filters : [{
						name : 'Supported Files', extensions : exts,
					}]
				}).then(result => {
					tempSourceFile = result.filePaths[0];
					if(tempSourceFile != undefined){
						tempDestinationFileName = remSpaces(tempSourceFile.split("\\")[tempSourceFile.split("\\").length-1]);
						console.log("Chosen file: " + tempDestinationFileName);
						doit();
					}else{
						console.log("Open Dialog canceled.");
					}
				});
			}
			
			//Add file with callback
			function addFile(fun){
				//source file should be the tempSourceFile and destination shud be tempDestinationDirectory + tempDestinationFileName
				doit = function(){
					fun();
				}
				//Copy the file to the destination
				fse.copySync(tempSourceFile, tempDestinationDirectory + tempDestinationFileName);
				fun();
			}
			
			//A function to check is this file name is duplicated or not
			function foundduplicatepanofile(filename){
				for(var i = 0; i < currentprojectdata.panoramas.length; i++){
					if(filename == currentprojectdata.panoramas[i].panofile)
						return true;
				}
				return false;
			}
			
			//Update the WTM File of current project
			function updateWtmFile(){
				fs.writeFile(wtmdata.projects[currentprojectindex].projectdir + "/WTMProject.wtm", JSON.stringify(currentprojectdata), function (err,data){});
				console.log("WTM File Updated.");
			}
			
			
			//fuckin messy click unclick menu blahblah
			$(".subabitem").on("click", function(){
				setTimeout(function(){
					$(".dropdown-content", this).hide();
					topmenuclicked = false;
					$("#topmenudim").hide();
				},500);
			});
			
			var topmenuclicked = false;
			$(".abitem").on("click", function(){
				$(".dropdown-content").hide();
				if(!topmenuclicked){
					$(".dropdown-content", this).show();
					topmenuclicked = true;
					$("#topmenudim").show();
				}else{
					topmenuclicked = false;
					$("#topmenudim").hide();
				}
			});
			
			$("#topmenudim, .rightbtn").on("click", function(){
				$(".dropdown-content").hide();
				topmenuclicked = false;
				$("#topmenudim").hide();
				$(".abitem").css({ "background-color" : "#2c3643" });
			});
			
			$(".abitem").not(".rightbtn").hover(function(){
				$(".dropdown-content").hide();
				$(".abitem").css({ "background-color" : "#2c3643" });
				$(this).css({ "background-color" : "#232c37" });
				if(topmenuclicked){
					$(".dropdown-content", this).show();
				}
			},function(){
				if(!topmenuclicked){
					$(".dropdown-content").hide();
					$(this).css({ "background-color" : "#2c3643" });
				}
			});
			
			$(".closebutton").hover(function(){
				$(this).css({ "background-color" : "#cf0000" });
			}, function(){
				$(this).css({ "background-color" : "#2c3643" });
			});
			
			$(".minmaxbutton, .minimizebutton").hover(function(){
				$(this).css({ "background-color" : "#0d9e59" });
			}, function(){
				$(this).css({ "background-color" : "#2c3643" });
			});
			
			$(".page").on("click", function(){
				topmenuclicked = false;
			});
			
			showpage("projects");
			
			$(document).ready(function(){
				$("body").fadeIn();
			});
			
			
			function limitHeight(){
				$("#recentprojects").css({ "height" : (innerHeight - 75) + "px", "overflow" : "auto" });
				$("#editorcontent").css({ "height" : (innerHeight-200) + "px" });
				$("#tutorials").css({ "height" : (innerHeight-100) + "px" });
			}
			
			$(window).resize(function(){
				limitHeight();
			});
			
			//Keyboard Shortcuts
			
			$(window).keydown(function(e){
				if(e.ctrlKey && e.which == 80){
					showpage("projects");
				}
				if(e.ctrlKey && e.which == 79){
					openproject();
				}
				if(e.ctrlKey && e.which == 81){
					quitprogram();
				}
				
				if(e.ctrlKey && e.which == 84){
					showpage('tutorials')
				}
				if(e.ctrlKey && e.which == 83){
					showMiniPage('donate');
				}
				if(e.ctrlKey && e.which == 66){
					showMiniPage('about')
				}
				
				e.preventDefault;
			});
			
			//Open link in external browser
			const shell = require('electron').shell;
			// assuming $ is jQuery
			$(document).on('click', 'a[href^="http"]', function(event) {
				event.preventDefault();
				shell.openExternal(this.href);
			});
			
			//Electron Bridge
			ipcRenderer.on("setnewinfospotlocation", (event, arg)=>{
				currentprojectdata.panoramas[currentpanoramaindex].hotspots.push({ "hotspotid" : randomblah(10), "title" : arg.title, "position" : arg.position, "actions" : [] });
				updateWtmFile();
				//generateHTMLPanoramas();
				showeditorc("hotspots");
			});
			
		</script>
		
	</body>
</html>